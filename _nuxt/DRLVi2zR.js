import{a9 as Me,O as Le,P as Oe,aa as $e,r as U,af as j,ac as me,i as S,T as Ne,bb as Ue,w as q,n as fe,bc as ze,Q as Ke,l as c,F as O,L as pe,bd as je,a2 as L,be as qe,a1 as Ge,q as J,bf as He,bg as We,bh as Je,_ as xe,e as _e,h as Qe,b as N,a as F,j as I,u as R,c as H,x as be,d as ie,J as Xe,am as Ye,z as he,t as W,s as re,M as Ze,N as ea}from"./4Ktyr8G_.js";import{g as aa}from"./BbY-I90a.js";import{V as ta}from"./U2mkAfXu.js";import{V as la}from"./M4sPlSOX.js";import{V as na,a as ye}from"./DlxhMtx2.js";import{V as ge,a as oa}from"./C-RzmdHL.js";import{V as ua}from"./BVo5q2wa.js";import{V as ae,b as sa}from"./B01AR6UH.js";import{V as ia}from"./DocC_KXZ.js";import{u as ra,a as ca,m as va,V as da}from"./er4xnGW9.js";import{u as ma,m as fa}from"./r4KKFxWL.js";import{u as pa}from"./ZuLc9MOj.js";import{f as ba}from"./DWGaNmQL.js";import{d as ha,t as G,V as ya,a as Ve}from"./Vc9XBB0d.js";import{V as ga}from"./BrBayNQn.js";import{V as Va}from"./BJWT1Lrs.js";import{V as xa}from"./CryL740R.js";import{V as _a}from"./BgxtWXOh.js";import{V as ka}from"./CdJNxXyl.js";const wa=e=>{const p=new FormData;return e&&p.append("file",e),$fetch("/sciapi/task/put-excl-file-attach",{method:"post",body:p,onRequest({options:y}){let o;o=Me("token"),y.headers=Object.assign(y.headers?y.headers:{},{"Blade-Requested-With":"BladeHttpRequest",Authorization:`Basic ${aa.encode("saber:saber_secret")}`,"Tenant-id":"000000"}),o.value&&(y.headers["Blade-Auth"]=`Bearer ${o.value}`)}})};function Ca(e,p,y){if(p==null)return e;if(Array.isArray(p))throw new Error("Multiple matches is not implemented");return typeof p=="number"&&~p?c(O,null,[c("span",{class:"v-combobox__unmask"},[e.substr(0,p)]),c("span",{class:"v-combobox__mask"},[e.substr(p,y)]),c("span",{class:"v-combobox__unmask"},[e.substr(p+y)])]):e}const Sa=Oe({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...fa({filterKeys:["title"]}),...va({hideNoData:!0,returnObject:!0}),...We(sa({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...He({transition:!1})},"VCombobox"),Fa=Le()({name:"VCombobox",props:Sa(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,p){var ce;let{emit:y,slots:o}=p;const{t:T}=$e(),k=U(),V=j(!1),C=j(!0),b=j(!1),te=U(),Q=U(),z=me(e,"menu"),d=S({get:()=>z.value,set:a=>{var u;z.value&&!a&&((u=te.value)!=null&&u.ΨopenChildren)||(z.value=a)}}),v=j(-1);let K=!1;const le=S(()=>{var a;return(a=k.value)==null?void 0:a.color}),l=S(()=>d.value?e.closeText:e.openText),{items:s,transformIn:t,transformOut:x}=ha(e),{textColorClasses:h,textColorStyles:ne}=Ne(le),i=me(e,"modelValue",[],a=>t(Ue(a)),a=>{const u=x(a);return e.multiple?u:u[0]??null}),$=pa(),X=S(()=>!!(e.chips||o.chip)),A=S(()=>X.value||!!o.selection),P=j(!e.multiple&&!A.value?((ce=i.value[0])==null?void 0:ce.title)??"":""),f=S({get:()=>P.value,set:a=>{var u;if(P.value=a??"",!e.multiple&&!A.value&&(i.value=[G(e,a)]),a&&e.multiple&&((u=e.delimiters)!=null&&u.length)){const m=a.split(new RegExp(`(?:${e.delimiters.join("|")})+`));m.length>1&&(m.forEach(n=>{n=n.trim(),n&&D(G(e,n))}),P.value="")}a||(v.value=-1),C.value=!a}}),ke=S(()=>typeof e.counterValue=="function"?e.counterValue(i.value):typeof e.counterValue=="number"?e.counterValue:e.multiple?i.value.length:f.value.length);q(P,a=>{K?fe(()=>K=!1):V.value&&!d.value&&(d.value=!0),y("update:search",a)}),q(i,a=>{var u;!e.multiple&&!A.value&&(P.value=((u=a[0])==null?void 0:u.title)??"")});const{filteredItems:Y,getMatches:we}=ma(e,s,()=>C.value?"":f.value),B=S(()=>e.hideSelected?Y.value.filter(a=>!i.value.some(u=>u.value===a.value)):Y.value),Ce=S(()=>i.value.map(a=>a.value)),oe=S(()=>{var u;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&f.value===((u=B.value[0])==null?void 0:u.title))&&B.value.length>0&&!C.value&&!b.value}),ue=S(()=>e.hideNoData&&!B.value.length||e.readonly||($==null?void 0:$.isReadonly.value)),se=U(),{onListScroll:Se,onListKeydown:Fe}=ra(se,k);function De(a){K=!0,e.openOnClear&&(d.value=!0)}function Ie(){ue.value||(d.value=!0)}function Re(a){ue.value||(V.value&&(a.preventDefault(),a.stopPropagation()),d.value=!d.value)}function Te(a){var n;if(Je(a)||e.readonly||$!=null&&$.isReadonly.value)return;const u=k.value.selectionStart,m=i.value.length;if((v.value>-1||["Enter","ArrowDown","ArrowUp"].includes(a.key))&&a.preventDefault(),["Enter","ArrowDown"].includes(a.key)&&(d.value=!0),["Escape"].includes(a.key)&&(d.value=!1),["Enter","Escape","Tab"].includes(a.key)&&(oe.value&&["Enter","Tab"].includes(a.key)&&!i.value.some(r=>{let{value:w}=r;return w===B.value[0].value})&&D(Y.value[0]),C.value=!0),a.key==="ArrowDown"&&oe.value&&((n=se.value)==null||n.focus("next")),a.key==="Enter"&&f.value&&(D(G(e,f.value)),A.value&&(P.value="")),["Backspace","Delete"].includes(a.key)){if(!e.multiple&&A.value&&i.value.length>0&&!f.value)return D(i.value[0],!1);if(~v.value){const r=v.value;D(i.value[v.value],!1),v.value=r>=m-1?m-2:r}else a.key==="Backspace"&&!f.value&&(v.value=m-1)}if(e.multiple){if(a.key==="ArrowLeft"){if(v.value<0&&u>0)return;const r=v.value>-1?v.value-1:m-1;i.value[r]?v.value=r:(v.value=-1,k.value.setSelectionRange(f.value.length,f.value.length))}if(a.key==="ArrowRight"){if(v.value<0)return;const r=v.value+1;i.value[r]?v.value=r:(v.value=-1,k.value.setSelectionRange(0,0))}}}function Ae(){var a;V.value&&(C.value=!0,(a=k.value)==null||a.focus())}function D(a){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!a||a.props.disabled))if(e.multiple){const m=i.value.findIndex(r=>e.valueComparator(r.value,a.value)),n=u??!~m;if(~m){const r=n?[...i.value,a]:[...i.value];r.splice(m,1),i.value=r}else n&&(i.value=[...i.value,a]);e.clearOnSelect&&(f.value="")}else{const m=u!==!1;i.value=m?[a]:[],P.value=m&&!A.value?a.title:"",fe(()=>{d.value=!1,C.value=!0})}}function Pe(a){V.value=!0,setTimeout(()=>{b.value=!0})}function Be(a){b.value=!1}function Ee(a){(a==null||a===""&&!e.multiple&&!A.value)&&(i.value=[])}return q(V,(a,u)=>{if(!(a||a===u)&&(v.value=-1,d.value=!1,f.value)){if(e.multiple){D(G(e,f.value));return}if(!A.value)return;i.value.some(m=>{let{title:n}=m;return n===f.value})?P.value="":D(G(e,f.value))}}),q(d,()=>{if(!e.hideSelected&&d.value&&i.value.length){const a=B.value.findIndex(u=>i.value.some(m=>e.valueComparator(m.value,u.value)));ze&&window.requestAnimationFrame(()=>{var u;a>=0&&((u=Q.value)==null||u.scrollToIndex(a))})}}),q(()=>e.items,(a,u)=>{d.value||V.value&&!u.length&&a.length&&(d.value=!0)}),Ke(()=>{const a=!!(!e.hideNoData||B.value.length||o["prepend-item"]||o["append-item"]||o["no-data"]),u=i.value.length>0,m=ae.filterProps(e);return c(ae,L({ref:k},m,{modelValue:f.value,"onUpdate:modelValue":[n=>f.value=n,Ee],focused:V.value,"onUpdate:focused":n=>V.value=n,validationValue:i.externalValue,counterValue:ke.value,dirty:u,class:["v-combobox",{"v-combobox--active-menu":d.value,"v-combobox--chips":!!e.chips,"v-combobox--selection-slot":!!A.value,"v-combobox--selecting-index":v.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0},e.class],style:e.style,readonly:e.readonly,placeholder:u?void 0:e.placeholder,"onClick:clear":De,"onMousedown:control":Ie,onKeydown:Te}),{...o,default:()=>c(O,null,[c(ga,L({ref:te,modelValue:d.value,"onUpdate:modelValue":n=>d.value=n,activator:"parent",contentClass:"v-combobox__content",disabled:ue.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:Ae},e.menuProps),{default:()=>[a&&c(ya,L({ref:se,selected:Ce.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:n=>n.preventDefault(),onKeydown:Fe,onFocusin:Pe,onFocusout:Be,onScrollPassive:Se,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},e.listProps),{default:()=>{var n,r,w;return[(n=o["prepend-item"])==null?void 0:n.call(o),!B.value.length&&!e.hideNoData&&(((r=o["no-data"])==null?void 0:r.call(o))??c(Ve,{title:T(e.noDataText)},null)),c(ca,{ref:Q,renderless:!0,items:B.value},{default:E=>{var de;let{item:g,index:M,itemRef:_}=E;const ve=L(g.props,{ref:_,key:M,active:oe.value&&M===0?!0:void 0,onClick:()=>D(g,null)});return((de=o.item)==null?void 0:de.call(o,{item:g,index:M,props:ve}))??c(Ve,L(ve,{role:"option"}),{prepend:Z=>{let{isSelected:ee}=Z;return c(O,null,[e.multiple&&!e.hideSelected?c(Va,{key:g.value,modelValue:ee,ripple:!1,tabindex:"-1"},null):void 0,g.props.prependAvatar&&c(xa,{image:g.props.prependAvatar},null),g.props.prependIcon&&c(pe,{icon:g.props.prependIcon},null)])},title:()=>{var Z,ee;return C.value?g.title:Ca(g.title,(Z=we(g))==null?void 0:Z.title,((ee=f.value)==null?void 0:ee.length)??0)}})}}),(w=o["append-item"])==null?void 0:w.call(o)]}})]}),i.value.map((n,r)=>{function w(_){_.stopPropagation(),_.preventDefault(),D(n,!1)}const E={"onClick:close":w,onKeydown(_){_.key!=="Enter"&&_.key!==" "||(_.preventDefault(),_.stopPropagation(),w(_))},onMousedown(_){_.preventDefault(),_.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},g=X.value?!!o.chip:!!o.selection,M=g?qe(X.value?o.chip({item:n,index:r,props:E}):o.selection({item:n,index:r})):void 0;if(!(g&&!M))return c("div",{key:n.value,class:["v-combobox__selection",r===v.value&&["v-combobox__selection--selected",h.value]],style:r===v.value?ne.value:{}},[X.value?o.chip?c(Ge,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:n.title}}},{default:()=>[M]}):c(_a,L({key:"chip",closable:e.closableChips,size:"small",text:n.title,disabled:n.props.disabled},E),null):M??c("span",{class:"v-combobox__selection-text"},[n.title,e.multiple&&r<i.value.length-1&&c("span",{class:"v-combobox__selection-comma"},[J(",")])])])})]),"append-inner":function(){var E;for(var n=arguments.length,r=new Array(n),w=0;w<n;w++)r[w]=arguments[w];return c(O,null,[(E=o["append-inner"])==null?void 0:E.call(o,...r),(!e.hideNoData||e.items.length)&&e.menuIcon?c(pe,{class:"v-combobox__menu-icon",icon:e.menuIcon,onMousedown:Re,onClick:je,"aria-label":T(l.value),title:T(l.value),tabindex:"-1"},null):void 0])}})}),ba({isFocused:V,isPristine:C,menu:d,search:f,selectionIndex:v,filteredItems:Y,select:D},k)}}),Da={__name:"GenericForm",props:{height:{type:String,default:""},analyseId:{type:String,default:""},fields:{type:Array,default:[]},isSubmit:{type:Boolean,default:!1}},emits:["submit"],setup(e,{emit:p}){const{t:y}=_e(),o=p,T=e,k=U(null),V=Qe(),C=async l=>{try{const t=await(await fetch(l)).blob(),x=new File([t],"sample.xlsx",{type:t.type,lastModified:new Date().getTime()});return console.log(x,"文件"),x}catch(s){console.error("下载文件失败:",s)}},b=U({...T.fields.reduce((l,s)=>(s.value!==void 0&&(l[s.prop]=s.value,s.type=="VFileInput"&&s.value&&(l[s.prop]=C(s.value),console.log(123123,l[s.prop]))),l),{})});(async()=>{const l={...T.fields.reduce((s,t)=>(t.value!==void 0&&(s[t.prop]=t.value),s),{})};for(const s of T.fields)s.type==="VFileInput"&&s.value&&(l[`${s.prop}File`]=s.value,l[s.prop]=await C(s.value));b.value=l,console.log(b.value,"formData.value")})(),console.log(b.value,"formData.value");const Q=l=>{switch(l){case"VSelect":return da;case"VFileInput":return ka;case"VTextField":return ae;case"VRadioGroup":return ge;case"VCombobox":return Fa;case"VSwitch":return ia;default:return ae}},z=(l,s)=>{if(l.control&&s[l.prop]!==void 0&&s[l.prop]!==null){const t=l.control(s[l.prop],s);Object.keys(t).forEach(x=>{T.fields.forEach(h=>{h.prop===x&&(h.display=t[x].display)})})}return l.display},d=l=>{switch(l.type){case"VSelect":return{items:l[`dicData${V.getLanguage}`],itemTitle:"label",itemValue:"value"};case"VCombobox":return{items:l[`dicData${V.getLanguage}`],itemTitle:"label",itemValue:"value"};default:return{}}},v=async()=>{const{valid:l}=await k.value.validate();l&&(console.log(b.value,"formData.value"),o("submit",b.value))},K=async()=>{const{valid:l}=await k.value.validate();l&&(console.log(b.value,"formData.value"),o("fineTuningAnalysis",b.value))},le=(l,s)=>{console.log(l,s,"val"),l.type=="VFileInput"&&wa(s).then(t=>{b.value[`${l.prop}File`]=t.data.bladeFile.link,l.parameterFileRelationsVOS.length>0&&l.parameterFileRelationsVOS.forEach(x=>{T.fields.forEach(h=>{h.prop===x.nameSign&&(h.dicDatazh=t.data.map[x.flieColumn],h.dicDataen=t.data.map[x.flieColumn])})})})};return(l,s)=>(F(),N(ua,{style:{height:"100%"}},{default:I(()=>[c(ta,null,{default:I(()=>[c(R(la),{ref_key:"form",ref:k},{default:I(()=>[c(na,null,{default:I(()=>[(F(!0),H(O,null,be(e.fields,(t,x)=>(F(),H(O,{key:x},[z(t,b.value)?(F(),H("div",{key:0,style:Xe({"flex-basis":t.row?"100%":t.cols==6?"50%":"100%","max-width":t.row?"100%":t.cols==6?"50%":"100%"})},[c(ye,{cols:!t.row&&t.cols==6?12:t.cols},{default:I(()=>[(F(),N(Ye(Q(t.type)),L({label:R(y)(`${t.label}`),modelValue:b.value[t.prop],"onUpdate:modelValue":h=>b.value[t.prop]=h,disabled:e.isSubmit&&t.disabled,rules:t.rules,multiple:t.multiple,hint:R(y)(`${t.hint}`),accept:t.accept},d(t),{"onUpdate:modelValue":h=>le(t,h)}),{default:I(()=>[t.type==="VRadioGroup"?(F(),N(R(ge),{key:0,modelValue:b.value[t.prop],"onUpdate:modelValue":h=>b.value[t.prop]=h},{default:I(()=>[(F(!0),H(O,null,be(t[`dicData${R(V).getLanguage}`],(h,ne)=>(F(),N(R(oa),{label:h.label,value:h.value,key:ne},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):ie("",!0)]),_:2},1040,["label","modelValue","onUpdate:modelValue","disabled","rules","multiple","hint","accept"]))]),_:2},1032,["cols"])],4)):ie("",!0)],64))),128)),c(ye,{class:"operation"},{default:I(()=>[e.analyseId?(F(),N(he,{key:0,"append-icon":"ri-send-plane-line",onClick:K,style:{"margin-right":"10px"}},{default:I(()=>[J(W(R(y)("analysisTool.Fine-tuning analysis")),1)]),_:1})):(F(),N(he,{key:1,"append-icon":"ri-send-plane-line",onClick:v},{default:I(()=>[J(W(R(y)("analysisTool.Submit")),1)]),_:1}))]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}))}},et=xe(Da,[["__scopeId","data-v-8e0c4f1d"]]),Ia=e=>(Ze("data-v-b256af62"),e=e(),ea(),e),Ra={key:0,class:"loading"},Ta=Ia(()=>re("div",{class:"spinner"},null,-1)),Aa={class:"title"},Pa={class:"time"},Ba={__name:"Loading",props:{visible:{type:Boolean,default:!1},time:{type:String,default:!1}},setup(e){const{t:p}=_e();return(y,o)=>e.visible?(F(),H("div",Ra,[Ta,re("p",Aa,[J(W(R(p)("analysisTool.Task analyzing, please wait"))+" ",1),re("span",Pa,W(e.time),1),J(" "+W(R(p)("analysisTool.hours please wait patiently")),1)])])):ie("",!0)}},at=xe(Ba,[["__scopeId","data-v-b256af62"]]);export{at as _,et as a};
