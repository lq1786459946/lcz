<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Vue3源码——h函数</title>
      <link href="//post/Vue3%E6%BA%90%E7%A0%81%E2%80%94%E2%80%94h%E5%87%BD%E6%95%B0.html"/>
      <url>//post/Vue3%E6%BA%90%E7%A0%81%E2%80%94%E2%80%94h%E5%87%BD%E6%95%B0.html</url>
      
        <content type="html"><![CDATA[<p>Vue和React这类框架比起远古时期的jQuery，最大的改变就是采用了<code>MVVM架构</code>。</p><p>而MVVM架构的核心，则是<code>虚拟DOM</code>。</p><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><h3 id="虚拟DOM"><a href="#虚拟DOM" class="headerlink" title="虚拟DOM"></a>虚拟DOM</h3><p>说到虚拟DOM，先得说起<strong>真实DOM</strong>。真实的DOM就是一颗<strong>HTML树</strong>，里面包含了<code>节点</code>、<code>属性</code>（<strong>class</strong>、<strong>id</strong>、<strong>style</strong>等）、<code>子节点</code>信息。</p><p>例如这样的DOM节点</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span> <span class="attr">class</span>=<span class="string">&quot;test&quot;</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>虚拟的DOM也要包括和真实DOM一样的信息。区别在于，它用<strong>JS对象</strong>来表示</p><p>例如刚才的DOM节点，用JS可以这样表示</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vnode = &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;div&quot;</span>,</span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="string">&quot;app&quot;</span>,</span><br><span class="line">        <span class="attr">class</span>: <span class="string">&quot;test&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">children</span>: <span class="string">&quot;hello world&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看出，这个vnode对象，用了<code>type</code>、<code>props</code>和<code>children</code>分别表示了这个真实DOM节点的<code>类型</code>（div）、<code>属性</code>（id为app，class为test）以及<code>子节点</code>（字符串hello world）。看着这样格式的JS对象，我们也可以很容易地推理得到一个真实的DOM节点。我们把这样的一个对象称之为<strong>虚拟DOM</strong>。</p><h3 id="h函数"><a href="#h函数" class="headerlink" title="h函数"></a>h函数</h3><p>在Vue源码中，虚拟DOM是由<code>h函数</code>生成的。生成时同样可以传入<code>节点类型</code>、<code>属性</code>以及<code>子节点信息</code>。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">h</span>(<span class="string">&quot;div&quot;</span>, &#123; <span class="attr">id</span>: <span class="string">&quot;app&quot;</span>, <span class="attr">class</span>: <span class="string">&quot;test&quot;</span> &#125;, <span class="string">&quot;hello world&quot;</span>)</span><br></pre></td></tr></table></figure><p>尝试打印这个h函数生成的vnode，内部信息比较丰富，用注释标注了一些核心的属性</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        <span class="comment">// 是否是VNode对象</span></span><br><span class="line">        <span class="string">&quot;__v_isVNode&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;__v_skip&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 节点类型</span></span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;div&quot;</span>,</span><br><span class="line">        <span class="comment">// 节点属性</span></span><br><span class="line">        <span class="string">&quot;props&quot;</span>: &#123; <span class="string">&quot;class&quot;</span>: <span class="string">&quot;test&quot;</span>, <span class="string">&quot;id&quot;</span>: <span class="string">&quot;app&quot;</span> &#125;,</span><br><span class="line">        <span class="string">&quot;key&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&quot;ref&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&quot;scopeId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&quot;slotScopeIds&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="comment">// 子节点</span></span><br><span class="line">        <span class="string">&quot;children&quot;</span>: <span class="string">&quot;hello world&quot;</span>,</span><br><span class="line">        <span class="string">&quot;component&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&quot;suspense&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&quot;ssContent&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&quot;ssFallback&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&quot;dirs&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&quot;transition&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&quot;el&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&quot;anchor&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&quot;target&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&quot;targetAnchor&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&quot;staticCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;shapeFlag&quot;</span>: <span class="number">9</span>,</span><br><span class="line">        <span class="string">&quot;patchFlag&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;dynamicProps&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&quot;dynamicChildren&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="string">&quot;appContext&quot;</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="h函数框架"><a href="#h函数框架" class="headerlink" title="h函数框架"></a>h函数框架</h2><h3 id="基本框架"><a href="#基本框架" class="headerlink" title="基本框架"></a>基本框架</h3><p>对于h函数，我们知道应该包括三个参数</p><ul><li>节点类型type</li><li>属性props（可选）</li><li>子节点children（可选）</li></ul><p>考虑到属性和子节点都是<strong>可选参数</strong>，因此要针对入参数量和类型做一些判断，大概的规则如下</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">h</span>(<span class="params">type: any, propsOrChildren?: any, children?: any</span>): <span class="title class_">VNode</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> l = <span class="variable language_">arguments</span>.<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 两个参数，不知道是props没传还是children没传</span></span><br><span class="line">  <span class="keyword">if</span> (l == <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isObject</span>(propsOrChildren) &amp;&amp; !<span class="title function_">isArray</span>(propsOrChildren)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isVNode</span>(propsOrChildren)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">createVNode</span>(type, <span class="literal">null</span>, [propsOrChildren]);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">createVNode</span>(type, propsOrChildren, []);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">createVNode</span>(type, <span class="literal">null</span>, propsOrChildren);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 三个及以上的参数，肯定是props和children都有</span></span><br><span class="line">    <span class="keyword">if</span> (l &gt; <span class="number">3</span>) &#123;</span><br><span class="line">      children = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="number">2</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (l === <span class="number">3</span> &amp;&amp; <span class="title function_">isVNode</span>(children)) &#123;</span><br><span class="line">      children = [children];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createVNode</span>(type, propsOrChildren, children);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>至于<strong>是否为vnode</strong>的判断，直接根据<code>__v_isVNode属性</code>就可得知</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isVNode</span>(<span class="params">value: any</span>): value is <span class="title class_">VNode</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> value ? value.<span class="property">__v_isVNode</span> === <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>整体框架出来了，接下来vnode的生成，主要就是<code>createVNode</code>这个方法了</p><h3 id="vnode的类型"><a href="#vnode的类型" class="headerlink" title="vnode的类型"></a>vnode的类型</h3><p>关于DOM节点，我们大概可以分成这样一些类别</p><ul><li>标准节点：div、h1等常规标签</li><li>注释节点</li><li>Fragment节点</li><li>组件</li><li>……</li></ul><p>那么，相对的，vnode也会区分一些节点类型。</p><p>查看Vue源码可以得知，里面包含了<strong>文本节点</strong><code>Text</code>、<strong>片段节点</strong><code>Fragment</code>、<strong>DOM节点</strong><code>Element</code>、<strong>组件节点</strong><code>Component</code>、<strong>注释节点</strong><code>Comment</code>等等。</p><p>此外，对于<code>children</code>来说，可能是<strong>一个</strong>，也可能是<strong>数组</strong>，甚至是<strong>对象</strong>、<strong>函数</strong>等等多种不同类型。</p><p>源码中，为了区分不同的节点，使用了<code>shapeFlag</code>，而且这个值还用二进制位进行计算。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> enum <span class="title class_">ShapeFlags</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * type = Element</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="variable constant_">ELEMENT</span> = <span class="number">1</span>,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 函数组件</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="variable constant_">FUNCTIONAL_COMPONENT</span> = <span class="number">1</span> &lt;&lt; <span class="number">1</span>,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 有状态（响应数据）组件</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="variable constant_">STATEFUL_COMPONENT</span> = <span class="number">1</span> &lt;&lt; <span class="number">2</span>,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * children = Text</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="variable constant_">TEXT_CHILDREN</span> = <span class="number">1</span> &lt;&lt; <span class="number">3</span>,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * children = Array</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="variable constant_">ARRAY_CHILDREN</span> = <span class="number">1</span> &lt;&lt; <span class="number">4</span>,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * children = slot</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="variable constant_">SLOTS_CHILDREN</span> = <span class="number">1</span> &lt;&lt; <span class="number">5</span>,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 组件：有状态（响应数据）组件 | 函数组件</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="variable constant_">COMPONENT</span> = <span class="title class_">ShapeFlags</span>.<span class="property">STATEFUL_COMPONENT</span> | <span class="title class_">ShapeFlags</span>.<span class="property">FUNCTIONAL_COMPONENT</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="h函数实现"><a href="#h函数实现" class="headerlink" title="h函数实现"></a>h函数实现</h2><h3 id="element节点-文本children"><a href="#element节点-文本children" class="headerlink" title="element节点+文本children"></a>element节点+文本children</h3><p>h函数最简单的用法是创建一个有tag名称的节点，子节点是文本。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vnode = <span class="title function_">h</span>(<span class="string">&quot;div&quot;</span>, <span class="string">&quot;hello world&quot;</span>);</span><br></pre></td></tr></table></figure><p>为了实现<code>VNode</code>的构建，需要先构建<code>createVNode</code>方法，接收<code>type</code>、<code>props</code>、<code>children</code>这三个参数。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> interface <span class="title class_">VNode</span> &#123;</span><br><span class="line">  <span class="attr">__v_isVNode</span>: <span class="literal">true</span></span><br><span class="line">  <span class="attr">type</span>: any</span><br><span class="line">  <span class="attr">props</span>: any</span><br><span class="line">  <span class="attr">children</span>: any</span><br><span class="line">  <span class="attr">shapeFlag</span>: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createVNode</span>(<span class="params">type, props, children</span>): <span class="title class_">VNode</span> &#123;</span><br><span class="line">  <span class="comment">// 这里先处理文本类型，其他的shapeFlag先不处理</span></span><br><span class="line">  <span class="keyword">const</span> shapeFlag = <span class="title function_">isString</span>(type) ? <span class="title class_">ShapeFlags</span>.<span class="property">ELEMENT</span> : <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">createBaseVNode</span>(type, props, children, shapeFlag);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>生成了<code>shapeFlag</code>后，要先创建VNode的一些基本属性，源码中用的就是<code>createBaseVNode</code>方法，并且在这之后使用<code>normalizeChildren</code>标准化children的类型（即使用<strong>位或运算</strong>得到一个shapeFlag值）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建基础vnode</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createBaseVNode</span>(<span class="params">type, props, children, shapeFlag</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> vnode = &#123;</span><br><span class="line">    <span class="attr">__v_isVNode</span>: <span class="literal">true</span>,</span><br><span class="line">    type,</span><br><span class="line">    props,</span><br><span class="line">    shapeFlag,</span><br><span class="line">  &#125; <span class="keyword">as</span> <span class="title class_">VNode</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">normalizeChildren</span>(vnode, children);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> vnode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">normalizeChildren</span>(<span class="params">vnode: VNode, children: unknown</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> type = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (children === <span class="literal">null</span>) &#123;</span><br><span class="line">    children = <span class="literal">null</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isArray</span>(children)) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 数组类型children处理</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> children === <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 对象类型的children处理</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isFunction</span>(children)) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 函数类型的children处理</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    children = <span class="title class_">String</span>(children);</span><br><span class="line">    type = <span class="title class_">ShapeFlags</span>.<span class="property">TEXT_CHILDREN</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  vnode.<span class="property">children</span> = children;</span><br><span class="line">  vnode.<span class="property">shapeFlag</span> |= type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时我们可以通过<code>h函数</code>拿到<code>tag</code>为<code>string</code>（例如<code>div</code>、<code>p</code>等），且<code>children</code>内容是<code>text</code>的vnode值了，和源码的核心内容是一致的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vnode = <span class="title function_">h</span>(<span class="string">&quot;div&quot;</span>, <span class="string">&quot;hello world&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(vnode); <span class="comment">// shapeFlag是9，children是hello world</span></span><br></pre></td></tr></table></figure><h3 id="element节点-数组children"><a href="#element节点-数组children" class="headerlink" title="element节点+数组children"></a>element节点+数组children</h3><p>相比于上一个节点类型，这个的区别就是children不再是一个节点，而是<strong>多个</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vnode = <span class="title function_">h</span>(<span class="string">&quot;div&quot;</span>, [<span class="title function_">h</span>(<span class="string">&quot;p&quot;</span>, <span class="string">&quot;p1&quot;</span>), <span class="title function_">h</span>(<span class="string">&quot;p&quot;</span>, <span class="string">&quot;p2&quot;</span>), <span class="title function_">h</span>(<span class="string">&quot;p&quot;</span>, <span class="string">&quot;p3&quot;</span>)]);</span><br></pre></td></tr></table></figure><p>其中每一个节点的解析就是刚才<code>element+text</code>这种组合，而且这几个节点会先被处理成<code>VNode</code>，唯一的区别是整体<code>div</code>这个节点</p><p>查看源码可以知道，我们只需要在最后生成<code>div</code>的<code>VNode</code>的时候提供一个<code>type</code>数值就行</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">normalizeChildren</span>(<span class="params">vnode: VNode, children: <span class="built_in">unknown</span></span>) &#123;</span><br><span class="line">  ......</span><br><span class="line"></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isArray</span>(children)) &#123;</span><br><span class="line">    <span class="keyword">type</span> = <span class="title class_">ShapeFlags</span>.<span class="property">ARRAY_CHILDREN</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这时候这个<code>VNode</code>的打印结果就和源码核心一致了</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vnode = <span class="title function_">h</span>(<span class="string">&quot;div&quot;</span>, [<span class="title function_">h</span>(<span class="string">&quot;p&quot;</span>, <span class="string">&quot;p1&quot;</span>), <span class="title function_">h</span>(<span class="string">&quot;p&quot;</span>, <span class="string">&quot;p2&quot;</span>), <span class="title function_">h</span>(<span class="string">&quot;p&quot;</span>, <span class="string">&quot;p3&quot;</span>)]);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(vnode); <span class="comment">// shapeFlag是17，children也是vnode节点，shapeFlag都是9</span></span><br></pre></td></tr></table></figure><p>从这里不难发现，VNode中一个很关键的属性是<code>shapeFlag</code>，正如名字一样，它描述了<strong>虚拟DOM节点的形状</strong>，而这个形状包括了<strong>父节点类型</strong>和<strong>子节点类型&#x2F;形状</strong>，其中：</p><ul><li>createBaseVNode：提供了父节点的类型</li><li>normalizeChildren：提供了子节点的类型和形状</li></ul><h3 id="组件Component"><a href="#组件Component" class="headerlink" title="组件Component"></a>组件Component</h3><p>首先要明确一个问题：在Vue中，组件的本质是<strong>对象&#x2F;函数</strong></p><p>所以实际上在Vue中写的组件，如果需要渲染的话，要用<strong>对象</strong>包裹，其中包含一个<code>render</code>方法</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> component = &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> vnode1 = <span class="title function_">h</span>(<span class="string">&quot;div&quot;</span>, <span class="string">&quot;this is component&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> vnode1;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vnode2 = <span class="title function_">h</span>(component);</span><br><span class="line"></span><br><span class="line"><span class="title function_">render</span>(vnode2, <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#app&#x27;</span>));</span><br></pre></td></tr></table></figure><p>按照之前的h函数实现和理解，其实我们可以在component的<code>render</code>中直接返回一个<code>VNode对象</code>，<code>render方法</code>直接给一个VNode对象，也能达到一样的效果，主要的注意点就是<code>shapeFlag值</code>要保持和源码一致</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> component = &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">v__is_vnode</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;div&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: <span class="string">&quot;this is component&quot;</span>,</span><br><span class="line">      <span class="attr">shapeFlag</span>: <span class="number">9</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">render</span>(&#123;</span><br><span class="line">  <span class="attr">v__is_vnode</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">type</span>: component,</span><br><span class="line">  <span class="attr">shapeFlag</span>: <span class="number">4</span></span><br><span class="line">&#125;, <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#app&#x27;</span>));</span><br></pre></td></tr></table></figure><p>所以只需要注意处理一下<code>type</code>和<code>shapeFlag</code>值，就可以完成组件component的h函数了，只要在<code>createVNode</code>中修改一行即可</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createVNode</span>(<span class="params"><span class="keyword">type</span>, props, children</span>): <span class="title class_">VNode</span> &#123;</span><br><span class="line">  ......</span><br><span class="line">  <span class="keyword">const</span> shapeFlag = <span class="title function_">isString</span>(<span class="keyword">type</span>)</span><br><span class="line">    ? <span class="title class_">ShapeFlags</span>.<span class="property">ELEMENT</span></span><br><span class="line">    : <span class="title function_">isObject</span>(<span class="keyword">type</span>)</span><br><span class="line">    ? <span class="title class_">ShapeFlags</span>.<span class="property">STATEFUL_COMPONENT</span></span><br><span class="line">    : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>按照之前的代码，最后生成的VNode里的children会变成”undefined”，其实是<code>normalizeChildren</code>里面的判断条件过于严苛了，把<code>===</code>改成<code>==</code>即可</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">normalizeChildren</span>(<span class="params">vnode: VNode, children: <span class="built_in">unknown</span></span>) &#123;</span><br><span class="line">  ......</span><br><span class="line">  <span class="keyword">if</span> (children == <span class="literal">null</span>) &#123;</span><br><span class="line">    children = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="其他一些简单节点"><a href="#其他一些简单节点" class="headerlink" title="其他一些简单节点"></a>其他一些简单节点</h3><p>这里的简单节点包括：</p><ul><li>纯文本<code>Text</code></li><li>注释<code>Comment</code></li><li>片段<code>Fragment</code></li></ul><p>查看源码可以发现，用h函数构建的这些节点的<code>type</code>都是<code>Symbol类型</code>，<code>shapeFlag</code>都是8</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vnodeText = <span class="title function_">h</span>(<span class="title class_">Text</span>, <span class="string">&quot;this is text&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vnodeComment = <span class="title function_">h</span>(<span class="title class_">Comment</span>, <span class="string">&quot;this is comment&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vnodeFragment = <span class="title function_">h</span>(<span class="title class_">Fragment</span>, <span class="string">&quot;this is fragment&quot;</span>);</span><br></pre></td></tr></table></figure><p>相比于之前的代码，我们只需要考虑<code>type</code>的问题，这里直接创建几个常量处理即可</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">Fragment</span> = <span class="title class_">Symbol</span>(<span class="string">&quot;Fragment&quot;</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">Text</span> = <span class="title class_">Symbol</span>(<span class="string">&quot;Text&quot;</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">Comment</span> = <span class="title class_">Symbol</span>(<span class="string">&quot;Comment&quot;</span>);</span><br></pre></td></tr></table></figure><p>处理完之后，h函数对这些简单节点的输出就和源码核心保持一致了</p><h2 id="class和style的增强处理"><a href="#class和style的增强处理" class="headerlink" title="class和style的增强处理"></a>class和style的增强处理</h2><p>Vue中对<code>class</code>和<code>style</code>，支持使用<strong>数组&#x2F;对象</strong>，动态绑定值</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vnode = <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">class</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;red&#x27;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="string">&#x27;improve class&#x27;</span>);</span><br></pre></td></tr></table></figure><p>按照上面的代码，可以拿到一个带有class为red的div</p><p>阅读源码得知，这个增强处理需要添加一个<code>normalizeClass方法</code>，方法本质上也是对class对象做一个<strong>遍历</strong>，针对<code>string</code>&#x2F;<code>array</code>&#x2F;<code>object</code>做不同的处理方式，最后拼接成<code>string</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">normalizeClass</span>(<span class="params">value: <span class="built_in">unknown</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> res = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isString</span>(value)) &#123;</span><br><span class="line">    res = value;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isArray</span>(value)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; value.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> normalized = <span class="title function_">normalizeClass</span>(value[i]);</span><br><span class="line">      <span class="keyword">if</span> (normalized) &#123;</span><br><span class="line">        res += normalized + <span class="string">&quot; &quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isObject</span>(value)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> name <span class="keyword">in</span> value <span class="keyword">as</span> <span class="built_in">object</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> ((value <span class="keyword">as</span> <span class="built_in">object</span>)[name]) &#123;</span><br><span class="line">        res += name + <span class="string">&quot; &quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">trim</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createVNode</span>(<span class="params"><span class="keyword">type</span>, props, children</span>): <span class="title class_">VNode</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (props) &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; <span class="attr">class</span>: klass, style &#125; = props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (klass &amp;&amp; !<span class="title function_">isString</span>(klass)) &#123;</span><br><span class="line">      props.<span class="property">class</span> = <span class="title function_">normalizeClass</span>(klass);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>style的处理逻辑上和class一致</p>]]></content>
      
      
      <categories>
          
          <category> Vue3 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue3.5 useId</title>
      <link href="//post/Vue3.5%20useId.html"/>
      <url>//post/Vue3.5%20useId.html</url>
      
        <content type="html"><![CDATA[<h2 id="useId的作用"><a href="#useId的作用" class="headerlink" title="useId的作用"></a>useId的作用</h2><p>他的作用也是生成唯一ID，同一个Vue应用里面每次调用<code>useId</code>生成的ID都不同。</p><p>使用方法也很简单，代码如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=<span class="string">&quot;ts&quot;</span>&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; useId &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> id0 = <span class="title function_">useId</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(id0); <span class="comment">// v-0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> id1 = <span class="title function_">useId</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(id1); <span class="comment">// v-1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> id2 = <span class="title function_">useId</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(id2); <span class="comment">// v-2</span></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="useId是如何实现的"><a href="#useId是如何实现的" class="headerlink" title="useId是如何实现的"></a>useId是如何实现的</h2><p>来看看<code>useId</code>的源码，非常简单！！简化后的代码如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">useId</span>(<span class="params"></span>): string &#123;</span><br><span class="line">  <span class="keyword">const</span> i = <span class="title function_">getCurrentInstance</span>()</span><br><span class="line">  <span class="keyword">if</span> (i) &#123;</span><br><span class="line">    <span class="keyword">return</span> (i.<span class="property">appContext</span>.<span class="property">config</span>.<span class="property">idPrefix</span> || <span class="string">&#x27;v&#x27;</span>) + <span class="string">&#x27;-&#x27;</span> + i.<span class="property">ids</span>[<span class="number">0</span>] + i.<span class="property">ids</span>[<span class="number">1</span>]++</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>生成的ID分为三部分：</p><ul><li><p>第一部分为前缀：<a href="https://link.juejin.cn/?target=https://cn.vuejs.org/api/application.html%23app-config-idprefix"><code>app.config.idPrefix</code></a>，如果没有配置，那么就是字符串<code>v</code>。</p></li><li><p>第二部分字符串：<code>-</code>。</p></li><li><p>第三部分的值为一个自增的数字，存在vue实例上面的<code>ids</code>属性，所有的vue实例上面的<code>ids</code>属性都是指向同一个数组。这也就是为什么说<code>useId</code>可以在<code>Vue应用内</code>生成唯一的ID，而不是在<code>Vue组件内</code>生成唯一的ID。</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Vue3 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端优化首次加载速度</title>
      <link href="//post/%E5%89%8D%E7%AB%AF%E4%BC%98%E5%8C%96%E9%A6%96%E6%AC%A1%E5%8A%A0%E8%BD%BD%E9%80%9F%E5%BA%A6.html"/>
      <url>//post/%E5%89%8D%E7%AB%AF%E4%BC%98%E5%8C%96%E9%A6%96%E6%AC%A1%E5%8A%A0%E8%BD%BD%E9%80%9F%E5%BA%A6.html</url>
      
        <content type="html"><![CDATA[<h2 id="compression-webpack-plugin"><a href="#compression-webpack-plugin" class="headerlink" title="compression-webpack-plugin"></a>compression-webpack-plugin</h2><p>compression-webpack-plugin 是一个 Webpack 插件，用于压缩生成的静态文件，通常是使用 Gzip 或 Brotli 压缩格式。这有助于减小文件大小，从而提高网页加载速度和性能。</p><h2 id="clean-webpack-plugin"><a href="#clean-webpack-plugin" class="headerlink" title="clean-webpack-plugin"></a>clean-webpack-plugin</h2><p>clean-webpack-plugin 是一个 Webpack 插件，用于在每次构建前自动清理输出目录（如 dist 文件夹），以确保新构建的文件是最新的，避免遗留旧文件。</p><h2 id="terser-webpack-plugin"><a href="#terser-webpack-plugin" class="headerlink" title="terser-webpack-plugin"></a>terser-webpack-plugin</h2><p>terser-webpack-plugin 是一个 Webpack 插件，用于压缩和混淆 JavaScript 代码，通常在生产环境中使用。它基于 Terser 工具，能够有效地减少 JavaScript 文件的体积，从而提高网页加载速度。</p><h2 id="html-webpack-plugin"><a href="#html-webpack-plugin" class="headerlink" title="html-webpack-plugin"></a>html-webpack-plugin</h2><p>html-webpack-plugin 是一个 Webpack 插件，用于简化生成 HTML 文件的过程，通常用于将打包的 JavaScript 和 CSS 文件自动注入到 HTML 模板中。</p><h2 id="vue-preload-webpack-plugin"><a href="#vue-preload-webpack-plugin" class="headerlink" title="@vue&#x2F;preload-webpack-plugin"></a>@vue&#x2F;preload-webpack-plugin</h2><p>@vue&#x2F;preload-webpack-plugin 是一个 Webpack 插件，主要用于优化 Vue 应用的资源加载性能。它可以自动添加 <link rel="preload"> 标签到生成的 HTML 文件中，以便浏览器预加载关键资源（如 JavaScript 和 CSS 文件）。</p><p>vue.config 文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> px2rem = <span class="built_in">require</span>(<span class="string">&quot;postcss-px2rem&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> postcss = <span class="title function_">px2rem</span>(&#123;</span><br><span class="line">  <span class="attr">remUnit</span>: <span class="number">37.5</span>, <span class="comment">// 基准大小 baseSize，需要和rem.js中相同</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> productionGzipExtensions = <span class="regexp">/\.(js|css|json|txt|html|ico|svg)(\?.*)?$/i</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CompressionPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;compression-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;clean-webpack-plugin&quot;</span>); <span class="comment">// 用于在每次构建前清理 /dist 文件夹</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TerserPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>); <span class="comment">// 用于压缩 JavaScript 代码</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">BundleAnalyzerPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;webpack-bundle-analyzer&quot;</span>); <span class="comment">//</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">PreloadPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;@vue/preload-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;events&quot;</span>).<span class="property">EventEmitter</span>.<span class="property">defaultMaxListeners</span> = <span class="number">0</span>;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 路径前缀</span></span><br><span class="line">  <span class="attr">publicPath</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_PUBLICPATH</span>,</span><br><span class="line">  <span class="attr">assetsDir</span>: <span class="string">&quot;static&quot;</span>,</span><br><span class="line">  <span class="comment">// 是否启用 eslint-loader 在保存时检查代码</span></span><br><span class="line">  <span class="attr">lintOnSave</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 是否生成 source map 文件，生产环境可以关闭以提升打包速度</span></span><br><span class="line">  <span class="attr">productionSourceMap</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> == <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="comment">// 扩展 webpack-chain 配置，进一步优化 Webpack 配置</span></span><br><span class="line">  <span class="attr">chainWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 忽略的打包文件</span></span><br><span class="line">    config.<span class="title function_">externals</span>(&#123;</span><br><span class="line">      <span class="attr">vue</span>: <span class="string">&quot;Vue&quot;</span>,</span><br><span class="line">      <span class="string">&quot;vue-router&quot;</span>: <span class="string">&quot;VueRouter&quot;</span>,</span><br><span class="line">      <span class="attr">vuex</span>: <span class="string">&quot;Vuex&quot;</span>,</span><br><span class="line">      <span class="attr">axios</span>: <span class="string">&quot;axios&quot;</span>,</span><br><span class="line">      <span class="string">&quot;element-ui&quot;</span>: <span class="string">&quot;ELEMENT&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置入口文件</span></span><br><span class="line">    <span class="keyword">const</span> entry = config.<span class="title function_">entry</span>(<span class="string">&quot;app&quot;</span>);</span><br><span class="line">    entry.<span class="title function_">add</span>(<span class="string">&quot;babel-polyfill&quot;</span>).<span class="title function_">end</span>();</span><br><span class="line">    entry.<span class="title function_">add</span>(<span class="string">&quot;classlist-polyfill&quot;</span>).<span class="title function_">end</span>();</span><br><span class="line">    entry.<span class="title function_">add</span>(<span class="string">&quot;@/mock&quot;</span>).<span class="title function_">end</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// // 配置预加载和预取，优化加载性能</span></span><br><span class="line">    <span class="comment">// config.plugin(&quot;preload&quot;).tap((options) =&gt; &#123;</span></span><br><span class="line">    <span class="comment">//   options[0].fileBlacklist.push(/\.map$/, /hot-update\.js$/);</span></span><br><span class="line">    <span class="comment">//   return options;</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 移除 prefetch 插件，避免加载不必要的资源</span></span><br><span class="line">    <span class="comment">// config.plugins.delete(&quot;prefetch&quot;);</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 配置 Webpack</span></span><br><span class="line">  <span class="attr">configureWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> plugins = [</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(),</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">        <span class="attr">template</span>: <span class="string">&quot;public/index.html&quot;</span>,</span><br><span class="line">        <span class="attr">inject</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">templateParameters</span>: &#123;</span><br><span class="line">          <span class="attr">BASE_URL</span>: <span class="string">&quot;/&quot;</span>, <span class="comment">// 传递 BASE_URL 到模板</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">PreloadPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">rel</span>: <span class="string">&quot;preload&quot;</span>,</span><br><span class="line">        <span class="attr">include</span>: <span class="string">&quot;initial&quot;</span>,</span><br><span class="line">        <span class="attr">fileBlacklist</span>: [<span class="regexp">/\.map$/</span>, <span class="regexp">/hot-update\.js$/</span>, <span class="regexp">/vendor\..*\.js$/</span>],</span><br><span class="line">        <span class="comment">// 根据需要进行更多配置</span></span><br><span class="line">      &#125;),</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;production&quot;</span> ||</span><br><span class="line">      process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;test&quot;</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      plugins.<span class="title function_">push</span>(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CompressionPlugin</span>(&#123;</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;[path][base].gz&quot;</span>,</span><br><span class="line">          <span class="attr">algorithm</span>: <span class="string">&quot;gzip&quot;</span>,</span><br><span class="line">          <span class="attr">test</span>: productionGzipExtensions,</span><br><span class="line">          <span class="attr">threshold</span>: <span class="number">10240</span>,</span><br><span class="line">          <span class="attr">minRatio</span>: <span class="number">0.8</span>,</span><br><span class="line">          <span class="attr">deleteOriginalAssets</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="comment">// exclude: /(cdn|util)\/.*\.(js|css|json|txt|html|ico|svg)$/i,</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">BundleAnalyzerPlugin</span>(&#123;</span><br><span class="line">          <span class="attr">analyzerMode</span>: <span class="string">&quot;static&quot;</span>,</span><br><span class="line">          <span class="attr">reportFilename</span>: <span class="string">&quot;bundle-report.html&quot;</span>,</span><br><span class="line">          <span class="attr">openAnalyzer</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      config.<span class="property">optimization</span> = &#123;</span><br><span class="line">        <span class="attr">minimize</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">minimizer</span>: [</span><br><span class="line">          <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">terserOptions</span>: &#123;</span><br><span class="line">              <span class="attr">compress</span>: &#123;</span><br><span class="line">                <span class="attr">drop_console</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">drop_debugger</span>: <span class="literal">true</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="attr">output</span>: &#123;</span><br><span class="line">                <span class="attr">comments</span>: <span class="literal">false</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">parallel</span>: <span class="literal">true</span>,</span><br><span class="line">          &#125;),</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">          <span class="comment">// Uncomment this block if needed</span></span><br><span class="line">          <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">          <span class="attr">maxInitialRequests</span>: <span class="number">5</span>,</span><br><span class="line">          <span class="attr">minSize</span>: <span class="number">30000</span>,</span><br><span class="line">          <span class="attr">maxSize</span>: <span class="number">250000</span>,</span><br><span class="line">          <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">            <span class="attr">vendor</span>: &#123;</span><br><span class="line">              <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">              <span class="title function_">name</span>(<span class="params"><span class="variable language_">module</span></span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> packageName = <span class="variable language_">module</span>.<span class="property">context</span>.<span class="title function_">match</span>(</span><br><span class="line">                  <span class="regexp">/[\\/]node_modules[\\/](.*?)([\\/]|$)/</span></span><br><span class="line">                )[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">return</span> <span class="string">`npm.<span class="subst">$&#123;packageName.replace(<span class="string">&quot;@&quot;</span>, <span class="string">&quot;&quot;</span>)&#125;</span>`</span>;</span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="attr">priority</span>: -<span class="number">10</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">common</span>: &#123;</span><br><span class="line">              <span class="attr">name</span>: <span class="string">&quot;common&quot;</span>,</span><br><span class="line">              <span class="attr">minChunks</span>: <span class="number">2</span>,</span><br><span class="line">              <span class="attr">priority</span>: -<span class="number">20</span>,</span><br><span class="line">              <span class="attr">reuseExistingChunk</span>: <span class="literal">true</span>,</span><br><span class="line">              <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;development&quot;</span>) &#123;</span><br><span class="line">      config.<span class="property">devtool</span> = <span class="string">&quot;source-map&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    config.<span class="property">plugins</span>.<span class="title function_">push</span>(...plugins);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">css</span>: &#123;</span><br><span class="line">    <span class="attr">extract</span>: &#123; <span class="attr">ignoreOrder</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    <span class="attr">loaderOptions</span>: &#123;</span><br><span class="line">      <span class="attr">postcss</span>: &#123;</span><br><span class="line">        <span class="attr">plugins</span>: [postcss],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">transpileDependencies</span>: [<span class="string">&quot;ol&quot;</span>],</span><br><span class="line">  <span class="comment">// 开发模式反向代理配置，生产模式请使用Nginx部署并配置反向代理</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">port</span>: <span class="number">1888</span>,</span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="string">&quot;/api&quot;</span>: &#123;</span><br><span class="line">        <span class="comment">// 本地服务接口地址</span></span><br><span class="line">        <span class="attr">target</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_BASE_API_COMMON_URL</span>,</span><br><span class="line">        <span class="comment">// 远程演示服务地址, 可用于直接启动项目</span></span><br><span class="line">        <span class="comment">// target: &#x27;https://saber.bladex.vip/api&#x27;,</span></span><br><span class="line">        <span class="attr">ws</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">          <span class="string">&quot;^/api&quot;</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 通过环境变量控制是否启用性能提示</span></span><br><span class="line">  <span class="comment">//  performance: &#123;</span></span><br><span class="line">  <span class="comment">//   hints: (process.env.NODE_ENV === &#x27;production&#x27; || process.env.NODE_ENV === &#x27;test&#x27;) ? &#x27;warning&#x27; : false</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="修改测试环境配置"><a href="#修改测试环境配置" class="headerlink" title="修改测试环境配置"></a>修改测试环境配置</h2><p>NODE_ENV 是一个环境变量，用于指示 Node.js 应用程序的运行环境。它通常有三个主要值： development 、 production 和 test 。</p><p>只有 production 生成环境才会压缩文件 如果是 NODE_ENV&#x3D;test 改成 NODE_ENV&#x3D;production</p><p><img src="https://atlas.pingcode.com/files/public/66ecd3315e0f3412bbbd3efe?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWRfZm9yX3B1YmljX2ltYWdlIjoiNDAyMTgwNDVhZjkzNDg3NTgyMDI5ZjNlZDI2ZjQ3ZmEiLCJ0ZWFtX2Zvcl9wdWJsaWNfaW1hZ2UiOiI2MTZkMmU2MzJhNjgwNWE3NWY4MjAxOTEiLCJpc19pbnRlcm5hbF90b2tlbiI6dHJ1ZSwiaWF0IjoxNzI2ODExNDYwLCJleHAiOjE3MjY4MjIyNjB9.skXyVJPe6TNvhJBiCDJx885ruVH84rnhluZ00YvkFm8" alt="image.png"></p><h2 id="修改动态路由懒加载方式"><a href="#修改动态路由懒加载方式" class="headerlink" title="修改动态路由懒加载方式"></a>修改动态路由懒加载方式</h2><ol><li><strong>加载时机</strong>：<ul><li><code>require</code>：同步加载，运行时决定。</li><li><code>import</code>：异步加载，编译时确定。</li></ul></li><li><strong>作用域</strong>：<ul><li><code>require</code>：在模块内部，作用域较封闭。</li><li><code>import</code>：支持命名导入和默认导入，灵活性更高。</li></ul></li><li><strong>环境</strong>：<ul><li><code>require</code>：主要用于 Node.js。</li><li><code>import</code>：适用于现代浏览器和支持 ES6 的环境。</li></ul></li></ol><p><img src="https://atlas.pingcode.com/files/public/66ecd4cea95c5fca81a44c17?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWRfZm9yX3B1YmljX2ltYWdlIjoiNDAyMTgwNDVhZjkzNDg3NTgyMDI5ZjNlZDI2ZjQ3ZmEiLCJ0ZWFtX2Zvcl9wdWJsaWNfaW1hZ2UiOiI2MTZkMmU2MzJhNjgwNWE3NWY4MjAxOTEiLCJpc19pbnRlcm5hbF90b2tlbiI6dHJ1ZSwiaWF0IjoxNzI2ODExNDYwLCJleHAiOjE3MjY4MjIyNjB9.skXyVJPe6TNvhJBiCDJx885ruVH84rnhluZ00YvkFm8" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> Vue2 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端大屏自适应方案</title>
      <link href="//post/%E5%89%8D%E7%AB%AF%E5%A4%A7%E5%B1%8F%E8%87%AA%E9%80%82%E5%BA%94%E6%96%B9%E6%A1%88.html"/>
      <url>//post/%E5%89%8D%E7%AB%AF%E5%A4%A7%E5%B1%8F%E8%87%AA%E9%80%82%E5%BA%94%E6%96%B9%E6%A1%88.html</url>
      
        <content type="html"><![CDATA[<h2 id="易用-🚀"><a href="#易用-🚀" class="headerlink" title="易用 🚀"></a>易用 🚀</h2><p>调用仅需一行代码，即可适配设置分辨率以下的所有屏幕，无需任何其他辅助</p><h2 id="性能-⚡"><a href="#性能-⚡" class="headerlink" title="性能 ⚡"></a>性能 ⚡</h2><p>只影响一个元素样式，计算量极小</p><h2 id="灵活-💥"><a href="#灵活-💥" class="headerlink" title="灵活 💥"></a>灵活 💥</h2><p>可以给项目全局自适应，也可以单独页面做自适应</p><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>即在 scale 等比缩放的基础上，获取屏幕的宽度除以设计稿的宽度，获取到宽度比例值；获取屏幕的高度除以设计稿的高度，获取到高度比例值；使用 transform: scale(x, x) 动态监听来实现页面的缩放比例，从而还原 UI 图效果。这可以支持设计稿以下的各种分辨率。</p><h2 id="使用代码"><a href="#使用代码" class="headerlink" title="使用代码"></a>使用代码</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">* 根据视口尺寸调整给定元素的缩放比例。</span><br><span class="line"> * @param &#123;<span class="title class_">HTMLElement</span>&#125; e - 要调整的元素。</span><br><span class="line"> * @param &#123;number&#125; planWidth - 元素的计划宽度,默认1980px。</span><br><span class="line"> * @param &#123;number&#125; planHeight - 元素的计划高度,默认1080px。</span><br><span class="line"> */</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">selfAdaption</span>(<span class="params">e, planWidth = <span class="number">1980</span>, planHeight = <span class="number">1080</span></span>) &#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取客户端视口的当前尺寸，并根据最小计划尺寸进行调整。</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@returns</span> &#123;<span class="type">&#123;width: number, height: number</span>&#125;&#125; 客户端视口的调整后宽度和高度。</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(planWidth, planHeight);</span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">getClientDimensions</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="comment">// 获取客户端视口的当前宽度和高度</span></span><br><span class="line">        <span class="keyword">let</span> width = <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientWidth</span> || <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientWidth</span>;</span><br><span class="line">        <span class="keyword">let</span> height = <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientHeight</span> || <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span>;</span><br><span class="line">        <span class="comment">// 如果计划高度小于1080，则进行高度调整</span></span><br><span class="line">        <span class="keyword">if</span> (planHeight &lt; <span class="number">1080</span>) &#123;</span><br><span class="line">          height -= (<span class="number">1080</span> - planHeight);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果计划宽度小于1920，则进行宽度调整</span></span><br><span class="line">        <span class="keyword">if</span> (planWidth &lt; <span class="number">1920</span>) &#123;</span><br><span class="line">          width -= (<span class="number">1920</span> - planWidth);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123; width, height &#125;;</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 根据当前视口尺寸更新元素的缩放比例。</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">updateScale</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="comment">// 获取调整后的客户端尺寸</span></span><br><span class="line">        <span class="keyword">const</span> &#123; width, height &#125; = <span class="title function_">getClientDimensions</span>();</span><br><span class="line">        <span class="comment">// 计算宽度和高度的缩放比例</span></span><br><span class="line">        <span class="keyword">const</span> ratioWidth = width / planWidth;</span><br><span class="line">        <span class="keyword">const</span> ratioHeight = height / planHeight;</span><br><span class="line">        <span class="comment">// 对元素应用缩放变换</span></span><br><span class="line">        e.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">`scale(<span class="subst">$&#123;ratioWidth&#125;</span>, <span class="subst">$&#123;ratioHeight&#125;</span>)`</span>;</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="comment">// 设置元素的初始样式</span></span><br><span class="line">      e.<span class="property">style</span>.<span class="property">cssText</span> += <span class="string">`</span></span><br><span class="line"><span class="string">    transform-origin: 0 0 0;</span></span><br><span class="line"><span class="string">    display: flex;</span></span><br><span class="line"><span class="string">    min-width: auto;</span></span><br><span class="line"><span class="string">    min-height: auto;</span></span><br><span class="line"><span class="string">    overflow: hidden;</span></span><br><span class="line"><span class="string">    width: <span class="subst">$&#123;planWidth&#125;</span>px;</span></span><br><span class="line"><span class="string">    height: <span class="subst">$&#123;planHeight&#125;</span>px;</span></span><br><span class="line"><span class="string">  `</span>;</span><br><span class="line">      <span class="comment">// 初始更新缩放比例</span></span><br><span class="line">      <span class="title function_">updateScale</span>();</span><br><span class="line">      <span class="comment">// 添加事件监听器，在窗口调整大小时更新缩放比例</span></span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, updateScale);</span><br><span class="line">    &#125;</span><br><span class="line">selfAdaption（e）传递的要自适应最外层dom</span><br></pre></td></tr></table></figure><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>使用 transform: scale 自适应后，地图上点击事件失效，解决办法：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">resetMapSize</span>(<span class="params"></span>) &#123; </span><br><span class="line">       <span class="keyword">let</span> mapContent = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;map&quot;</span>); </span><br><span class="line">       mapContent.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">`scale(<span class="subst">$&#123;<span class="number">1</span> / ratioWidth&#125;</span>,<span class="subst">$&#123;<span class="number">1</span> / ratioHeight&#125;</span>)`</span> </span><br><span class="line">     &#125; </span><br><span class="line"> <span class="comment">// 用完后记得销毁监听事件 比如 vue 中 </span></span><br><span class="line"> destroyed () &#123; </span><br><span class="line">     <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;resize&#x27;</span>,<span class="variable language_">this</span>.<span class="property">resetMapSize</span>) </span><br><span class="line">   &#125; </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue3.5 源码解析， useTemplateRef 实现原理</title>
      <link href="//post/Vue3.5%20%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%EF%BC%8C%20useTemplateRef%20%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86.html"/>
      <url>//post/Vue3.5%20%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%EF%BC%8C%20useTemplateRef%20%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86.html</url>
      
        <content type="html"><![CDATA[<h2 id="useTemplateRef-的作用"><a href="#useTemplateRef-的作用" class="headerlink" title="useTemplateRef 的作用"></a>useTemplateRef 的作用</h2><p>useTemplateRef 是用来专门获取 dom 或者 组件示例 的。</p><p>在之前，如果我们想要获取 dom ，那么需要这么做：</p><ol><li><p>先为 dom 指定 ref 属性，并且给定一个 value 值</p></li><li><p>在 js 中，声明 value 值的变量，并且给定初始值为 空的 ref</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="comment">// 首先，您定义了一个值为undefined或空的ref</span></span><br><span class="line"><span class="comment">// 并以您想要的方式命名生成的可用内容</span></span><br><span class="line"><span class="keyword">const</span> divEl = <span class="title function_">ref</span>();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="comment">&lt;!-- 然后使用与“ref”属性的值相同的名称,在模板中的某个地方 --&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&quot;divEl&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>但是，这种方案存在一个问题，那就是：ref 通常用来声明响应式数据。当 ref 不光作为响应式声明，还被作为 dom 实例的时候，那么就难免有点让人疑惑了。</p><p>所以在（3.5 之后） Vue 推出了一个新的 API 叫做 useTemplateRef 来解决这个问题：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&quot;el&quot;</span>&gt;</span>程序员Sunday<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; onMounted, useTemplateRef &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> elRef = <span class="title function_">useTemplateRef</span>(<span class="string">&#x27;el&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"> <span class="variable language_">console</span>.<span class="title function_">log</span>(elRef.<span class="property">value</span>) <span class="comment">// dom 示例</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li></ol><h2 id="useTemplateRef-的实现原理"><a href="#useTemplateRef-的实现原理" class="headerlink" title="useTemplateRef 的实现原理"></a>useTemplateRef 的实现原理</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useTemplateRef</span>(<span class="params">key: Keys</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> i = <span class="title function_">getCurrentInstance</span>();</span><br><span class="line">  <span class="keyword">const</span> r = <span class="title function_">shallowRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">if</span> (i) &#123;</span><br><span class="line">    <span class="keyword">const</span> refs = i.<span class="property">refs</span> === <span class="variable constant_">EMPTY_OBJ</span> ? (i.<span class="property">refs</span> = &#123;&#125;) : i.<span class="property">refs</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(refs, key, &#123;</span><br><span class="line">      <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">get</span>: <span class="function">() =&gt;</span> r.<span class="property">value</span>,</span><br><span class="line">      <span class="attr">set</span>: <span class="function">(<span class="params">val</span>) =&gt;</span> (r.<span class="property">value</span> = val),</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="第一个-i：通过-getCurrentInstance-获取，得到的是-上下文实例。"><a href="#第一个-i：通过-getCurrentInstance-获取，得到的是-上下文实例。" class="headerlink" title="第一个 i：通过 getCurrentInstance() 获取，得到的是 上下文实例。"></a>第一个 i：通过 getCurrentInstance() 获取，得到的是 上下文实例。</h5><p>​ 接下来，通过 i.refs 获取到所有的 ref 数据，然后为 refs 添加 Object.defineProperty 的监听，监听的属性名就是入参 key。如果以 useTemplateRef(‘el’) 为例，那么就是 “el”。</p><p>通过监听对应 key 的 get 和 set 标记，这里 重点关注 set 标记，在这里为 r.value 进行了赋值，即：r.value &#x3D; val。这里的 val 就是 refs[key] 的值，也就是对应的 ref 组件实例。</p><h5 id="第二个-r：通过-shallowRef-null-获取，作为返回值"><a href="#第二个-r：通过-shallowRef-null-获取，作为返回值" class="headerlink" title="第二个 r：通过 shallowRef(null) 获取，作为返回值"></a>第二个 r：通过 shallowRef(null) 获取，作为返回值</h5><p>r 作为 useTemplateRef 的返回值即 最终获取的组件示例。</p>]]></content>
      
      
      <categories>
          
          <category> Vue3 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ref和reactive原理</title>
      <link href="//post/ref%E5%92%8Creactive%E5%8E%9F%E7%90%86.html"/>
      <url>//post/ref%E5%92%8Creactive%E5%8E%9F%E7%90%86.html</url>
      
        <content type="html"><![CDATA[<h2 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h2><p>ref 的处理上就是先将基本类型转换成对象类型，然后在里面加入一个 this._v_isRef 的布尔类型的值，来判断它是不是被 ref 处理了，然后将上面写的 track 和 trigger 函数写入 get 和 set 函数里面，如果你要处理的是一个对象，那么 vue3 就会把它改成 reactive 的处理方式。所以说，ref 可以处理基本类型和引用类型，而 reactive 处理的是引用类型，二者的区别不是很大。</p><h2 id="reactive"><a href="#reactive" class="headerlink" title="reactive"></a>reactive</h2><ul><li><p>首先我们取一个对象{a: 1}</p></li><li><p>然后调用封装好的 reactive 函数 const state &#x3D; reactive({a: 1})</p></li><li><p>这个时候就会进入代码片段 1.1 里面的 reactive 函数，在进入 createReactiveObject 函数</p></li><li><p>然后就会对我们要代理的对象进行判断，如果是对象的话就继续下去</p></li><li><p>在判断我们是不是已经代理过这个对象（就是我们预先空出一个位置，将已经代理过的对象全部存储下来），代理过就返回代理后的值，没有的话就创建一个新的代理</p></li><li><p>再然后绑定上 proxy 函数里面的 get 和 set 回调函数（可以看到代码 1.2）</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Vue3 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue3 Api</title>
      <link href="//post/vue3%20Api.html"/>
      <url>//post/vue3%20Api.html</url>
      
        <content type="html"><![CDATA[<p><strong>defineProps()和 defineEmits()</strong></p><p>v-model:childValueModel 修改了值 本来应该是 modeValue</p><p>defineEmites() 使用要添加 update:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;defineModelChild v-model;childValueModel=<span class="string">&quot;childValue&quot;</span>&gt;&lt;/defineModelChild&gt;</span><br></pre></td></tr></table></figure><p>​</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; childValueModel &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;myEmits(&#x27;update:childValueModel&#x27;, childValueModel + 1)&quot;</span>&gt;</span>数据 + 1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> myProps = <span class="title function_">defineProps</span>([<span class="string">&#x27;childValueModel&#x27;</span>]);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> myEmits= <span class="title function_">defineEmits</span>([<span class="string">&#x27;update:childValueModel&#x27;</span>]);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>父组件</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HelloWorld</span> <span class="keyword">from</span> <span class="string">&#x27;./components/defineProps-----defineEmits .vue&#x27;</span></span><br><span class="line"><span class="comment">//父组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">count</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">HelloWorld</span> <span class="attr">a</span>=<span class="string">&quot;qwdqwd&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    @<span class="attr">count</span>=<span class="string">&#x27;count&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>子组件</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span><br><span class="line"><span class="comment">//子组件</span></span><br><span class="line"><span class="keyword">let</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">let</span> emit = <span class="title function_">defineEmits</span>([<span class="string">&quot;count&quot;</span>])</span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>((&#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="title class_">String</span></span><br><span class="line">&#125;))</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">  count.<span class="property">value</span>++</span><br><span class="line">  <span class="title function_">emit</span>(<span class="string">&quot;count&quot;</span>, count.<span class="property">value</span>)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;increment&quot;</span>&gt;</span>&#123;&#123; count &#125;&#125; &#123;&#123;props.a&#125;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>defineModel() 3.4+版本</strong></p><p>defineModel 其实也是一个语法糖，是对 v-model 再包装的语法糖</p><p>defineModel 帮你获取到了 prop 中的 modelValue ，且当 值发生变化时，会自动帮你调用 update:modelValue</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myProps = <span class="title function_">defineProps</span>([<span class="string">&quot;modelValue&quot;</span>]);</span><br><span class="line"><span class="keyword">const</span> myEmits = <span class="title function_">defineEmits</span>([<span class="string">&quot;update:modelValue&quot;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 说白了，这里的 modelValue 等价于 props.modelValue + emit(&#x27;update:modelValue&#x27;)</span></span><br><span class="line"><span class="comment">// defineModel 帮你 封装了 modelValue 和 update:modelValue</span></span><br><span class="line"><span class="keyword">const</span> modelValue = <span class="title function_">defineModel</span>();</span><br></pre></td></tr></table></figure><p><strong>父组件</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">defineModelChild</span> <span class="attr">v-model</span>=<span class="string">&quot;childValue&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">defineModelChild</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> defineModelChild <span class="keyword">from</span> <span class="string">&#x27;./components/defineModelChild.vue&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> childValue = <span class="title function_">ref</span>(<span class="number">0</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>v-model 子组件</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; modelValue &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;myEmits(&#x27;update:modelValue&#x27;, modelValue + 1)&quot;</span>&gt;</span>数据 + 1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">defineProps</span>([<span class="string">&#x27;modelValue&#x27;</span>]);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> myEmits = <span class="title function_">defineEmits</span>([<span class="string">&#x27;update:modelValue&#x27;</span>]);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>defineModel() 子组件</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; modelValue &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;modelValue++&quot;</span>&gt;</span>数据 + 1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> modelValue = <span class="title function_">defineModel</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>defineExpose 子传父</strong></p><p>（用在子组件，暴露想传递的值或方法，父组件通过 ref 属性获取子组件暴露的）</p><p>使用 script setup 的组件是默认关闭的——即通过模板引用或者 $parent 链获取到的组件的公开实例，不会暴露任何在 script setup 中声明的绑定。</p><p>那么，通过 defineExpose 编译器宏来显式指定在</p><p>然后，父组件通过 ref 属性访问子组件</p><p><strong>父组件：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Index</span> ref=<span class="string">&quot;childeRef&quot;</span>&gt;&lt;/<span class="title class_">Index</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span> <span class="title class_">Index</span> <span class="keyword">from</span> <span class="string">&quot;./index.vue&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> childeRef = <span class="title function_">ref</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(childeRef.<span class="property">value</span>.<span class="property">msg</span>) <span class="comment">// Hello World</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">let</span> <span class="attr">flag</span>:boolean = <span class="literal">true</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">let</span> <span class="attr">value</span>:number= <span class="number">5</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      childeRef.<span class="property">value</span>.<span class="title function_">childFn</span>(flag,value) <span class="comment">// 调用子组件函数, 输出 6</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>子组件：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">    <span class="keyword">import</span> &#123;ref&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">childFn</span>(<span class="params">type：boolean, data：number</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;我是子组件&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(data)&#123;</span><br><span class="line">           <span class="keyword">let</span> value = data + <span class="number">1</span>;</span><br><span class="line">           <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> msg = <span class="string">&#x27;Hello World&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">defineExpose</span>(&#123; <span class="comment">//暴露想要传递的值或方法</span></span><br><span class="line">        msg,</span><br><span class="line">        childFn,</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><strong>defineOptions 3.3+</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; defineOptions &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line"><span class="attr">name</span>: <span class="string">&#x27;Foo&#x27;</span>,</span><br><span class="line"><span class="comment">//组件重命名</span></span><br><span class="line"> <span class="attr">inheritAttrs</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="comment">//...更多自定义属性</span></span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><strong>computed 计算属性</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup &gt;</span><br><span class="line"><span class="keyword">import</span> &#123; computed, reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> author = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">books</span>: [</span><br><span class="line">    <span class="string">&#x27;Vue 2 - Advanced Guide&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Vue 3 - Basic Guide&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Vue 4 - The Mystery&#x27;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> publishedBooksMessage = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> author.<span class="property">books</span>.<span class="property">length</span> &gt; <span class="number">0</span> ? <span class="string">&#x27; Yes&#x27;</span> : <span class="string">&quot;No&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;&#123; publishedBooksMessage &#125;&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>  <span class="attr">scoped</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>computed 传参</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup &gt;</span><br><span class="line"><span class="keyword">import</span> &#123; computed, reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> author = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;John Doe&#x27;</span>,</span><br><span class="line">  <span class="attr">books</span>: [</span><br><span class="line">    <span class="string">&#x27;Vue 2 - Advanced Guide&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Vue 3 - Basic Guide&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Vue 4 - The Mystery&#x27;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> publishedBooksMessage = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value)</span><br><span class="line">    <span class="keyword">return</span> author.<span class="property">books</span>.<span class="property">length</span> &gt; <span class="number">0</span> ? <span class="string">&#x27; Yes&#x27;</span> : <span class="string">&quot;No&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Has published books:<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;&#123; publishedBooksMessage(12) &#125;&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>  <span class="attr">scoped</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>watch 监听</strong></p><p><strong>默认开启深度监听</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup &gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref, watch &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">btnClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  count.<span class="property">value</span>++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ✅ 方法一，传递响应对象</span></span><br><span class="line"><span class="title function_">watch</span>(count, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(newValue, oldValue)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// ❌ 方法二：传递响应对象下的属性</span></span><br><span class="line"><span class="title function_">watch</span>(user.<span class="property">name</span>, <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value) <span class="comment">// 监听失败，没输出</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// ✅ 方法三：传递函数，函数返回响应对象属性</span></span><br><span class="line"><span class="title function_">watch</span>(<span class="function">() =&gt;</span> user.<span class="property">name</span>, <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value); <span class="comment">// 监听成功，输出 jake</span></span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;btnClick&quot;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;&#123; count &#125;&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>  <span class="attr">scoped</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>watchEffect 的使用</strong></p><p>watchEffect 也是一个帧听器，是一个副作用函数。 它会监听引用数据类型的所有属性，不需要具体到某个属性，一旦运行就会立即监听，组件卸载的时候会停止监听。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup &gt;</span><br><span class="line"><span class="keyword">import</span> &#123; reactive, ref, watch, watchEffect &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> count = <span class="title function_">reactive</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;112&#x27;</span>, <span class="attr">data</span>: [<span class="string">&quot;你好&quot;</span>] &#125;)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">btnClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  count.<span class="property">data</span>[<span class="number">0</span>] = <span class="string">&#x27;被改了&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(count.<span class="property">data</span>[<span class="number">0</span>]);</span><br><span class="line">&#125;)</span><br><span class="line"> <span class="title function_">watch</span>([count,obj],<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;监听的多个数据改变了&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;btnClick&quot;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;&#123;count.data[0]&#125;&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>  <span class="attr">scoped</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>stopWatchEffect 停止监听</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> stop = <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;name:&quot;</span>, obj.<span class="property">name</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">stopWatchEffect</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;停止监听&quot;</span>);</span><br><span class="line">  <span class="title function_">stop</span>();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>onInvalidate 函数 解决执行顺序乱的问题</p>]]></content>
      
      
      <categories>
          
          <category> Vue3 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue3 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
