import{_ as Te,a as Ve}from"./DRLVi2zR.js";import{_ as ce,r as c,o as xe,c as j,a as p,b as m,d as _,u as s,F as Y,n as y,e as ie,f as Se,h as Ce,i as re,w as be,j as n,k as we,l as o,m as K,p as w,q as f,t as u,v as L,s as h,x as ue,V as Le,y as ke,z as Fe,A as $e,B as De,C as Re}from"./4Ktyr8G_.js";import{V as Ae}from"./C01xEgWl.js";import{a as I}from"./-VStuZKb.js";import{t as Ie,c as Ee,d as He,s as Pe,p as Oe,a as Ue,b as Ze,e as Be}from"./En6PCPt1.js";import{V as Me}from"./BKBrnQ3t.js";import{V as N,a as d}from"./DlxhMtx2.js";import{V as ze}from"./BVo5q2wa.js";import{V as Ge,a as Q,b as Ne,c as X}from"./CT10tW2C.js";import{V as je}from"./U2mkAfXu.js";import{V as qe,a as We,b as Je,c as Ke}from"./DL4jBOK2.js";import{V as Qe}from"./BgxtWXOh.js";import{V as Xe}from"./r4KKFxWL.js";import"./BbY-I90a.js";import"./M4sPlSOX.js";import"./ZuLc9MOj.js";import"./DWGaNmQL.js";import"./C-RzmdHL.js";import"./D-5uWIj4.js";import"./B01AR6UH.js";import"./DocC_KXZ.js";import"./er4xnGW9.js";import"./Vc9XBB0d.js";import"./CryL740R.js";import"./B8vluWYP.js";import"./BrBayNQn.js";import"./BxUkLsYu.js";import"./BJWT1Lrs.js";import"./CdJNxXyl.js";import"./C3lmZdGn.js";import"./By1GlJfL.js";/* empty css        */import"./BuQiNUq5.js";import"./D9lrzzyk.js";const Ye={__name:"SseComponent",props:{url:{type:String,required:!1},type:{type:String,required:!1},executionTime:{type:String,required:!1},time:{type:Number,default:!1},eventType:{type:String,default:"message"},withCredentials:{type:Boolean,default:!1}},emits:["message","error","open"],setup(k,{expose:ee,emit:S}){let E=c("");const i=k,Z=S,F=c(!0),T=c(null),H=()=>{try{console.log(i.type,"props.type"),F.value=!0,E.value="",T.value=new EventSource(i.url,{withCredentials:i.withCredentials}),console.log(T.value,"eventSource.value"),T.value.onmessage=V=>{console.log("收到消息内容是:",V.data,i.type),V.data=="Task completed"&&(F.value=!1,Z("message"),T.value.close()),i.type=="subscribe"&&(E.value+=`
`+V.data,y(()=>{const C=document.getElementById("sse-textarea");C&&(C.scrollTop=C.scrollHeight)}))},T.value.onerror=V=>{T.value.close()}}catch(V){Z("error",V),v()}},v=()=>{clearTimeout(reconnectTimeout.value),reconnectTimeout.value=setTimeout(()=>{console.log("尝试重新连接 SSE..."),H()},5e3)};return xe(()=>{T.value&&T.value.close()}),ee({initSse:H}),(V,C)=>{const R=Te;return p(),j(Y,null,[k.type=="subscribeResult"&&!k.executionTime?(p(),m(R,{key:0,time:k.time,visible:F.value},null,8,["time","visible"])):_("",!0),k.type=="subscribe"&&!k.executionTime?(p(),m(Ae,{key:1,id:"sse-textarea","model-value":s(E),readonly:""},null,8,["model-value"])):_("",!0)],64)}}},ea=ce(Ye,[["__scopeId","data-v-99dfcf2e"]]),aa=`<svg width="460" height="362" viewBox="0 0 460 362" fill="none" xmlns="http://www.w3.org/2000/svg">\r
<path d="M132 32.25V100H245V14.25C245 6.37994 238.62 0 230.75 0C222.88 0 216.5 6.37994 216.5 14.25V22.5C216.5 27.4706 212.471 31.5 207.5 31.5H178.071C174.994 31.5 172.5 29.0056 172.5 25.9286C172.5 18.236 166.264 12 158.571 12H152.25C141.066 12 132 21.0662 132 32.25Z" fill="url(#paint0_linear_115_10258)"/>\r
<ellipse cx="230" cy="265.5" rx="230" ry="96.5" fill="#2AB2AB"/>\r
<ellipse cx="230" cy="265.5" rx="230" ry="96.5" fill="url(#paint1_linear_115_10258)"/>\r
<path d="M46 110.5V221H401.5V84C401.5 74.335 393.665 66.5 384 66.5C374.335 66.5 366.5 74.335 366.5 84V141.75C366.5 145.478 363.478 148.5 359.75 148.5H359.571C355.942 148.5 353 145.558 353 141.929C353 132.855 345.645 125.5 336.571 125.5H325.571C322.494 125.5 320 123.006 320 119.929C320 112.236 313.764 106 306.071 106H150.857C145.137 106 140.5 110.637 140.5 116.357C140.5 118.645 138.645 120.5 136.357 120.5H130.643C125.317 120.5 121 124.817 121 130.143C121 132.273 119.273 134 117.143 134H93.8571C87.3086 134 82 128.691 82 122.143V110.5C82 100.559 73.9411 92.5 64 92.5C54.0589 92.5 46 100.559 46 110.5Z" fill="url(#paint2_linear_115_10258)"/>\r
<path d="M173.5 330L394 317.5L300 230L148 217L173.5 330Z" fill="url(#paint3_linear_115_10258)"/>\r
<rect x="148" y="67" width="163" height="163" rx="15" fill="#2AB2AB"/>\r
<path d="M148 93H311V215C311 223.284 304.284 230 296 230H163C154.716 230 148 223.284 148 215V93Z" fill="#2AB2AB"/>\r
<path d="M148 93H311V215C311 223.284 304.284 230 296 230H163C154.716 230 148 223.284 148 215V93Z" fill="url(#paint4_linear_115_10258)"/>\r
<rect x="163" y="111" width="133" height="52" rx="6" fill="white"/>\r
<rect x="163" y="186" width="47" height="7" rx="3.5" fill="white"/>\r
<rect x="163" y="202" width="106" height="7" rx="3.5" fill="white"/>\r
<path fill-rule="evenodd" clip-rule="evenodd" d="M240.269 129.262C241.244 128.287 241.244 126.706 240.269 125.731C239.294 124.756 237.714 124.756 236.739 125.731L228.5 133.969L220.262 125.731C219.287 124.756 217.707 124.756 216.732 125.731C215.757 126.706 215.757 128.287 216.732 129.262L224.97 137.5L216.732 145.738C215.757 146.713 215.757 148.294 216.732 149.269C217.707 150.244 219.287 150.244 220.262 149.269L228.5 141.031L236.739 149.269C237.714 150.244 239.294 150.244 240.269 149.269C241.244 148.294 241.244 146.713 240.269 145.738L232.031 137.5L240.269 129.262Z" fill="#2AB2AB"/>\r
<path fill-rule="evenodd" clip-rule="evenodd" d="M240.268 129.262C241.243 128.287 241.243 126.706 240.268 125.731C239.293 124.756 237.713 124.756 236.738 125.731L228.5 133.969L220.261 125.731C219.286 124.756 217.706 124.756 216.731 125.731C215.756 126.706 215.756 128.287 216.731 129.262L224.969 137.5L216.731 145.738C215.756 146.713 215.756 148.294 216.731 149.269C217.706 150.244 219.286 150.244 220.261 149.269L228.5 141.031L236.738 149.269C237.713 150.244 239.293 150.244 240.268 149.269C241.243 148.294 241.243 146.713 240.268 145.738L232.03 137.5L240.268 129.262Z" fill="white" fill-opacity="0.6"/>\r
<defs>\r
<linearGradient id="paint0_linear_115_10258" x1="188.5" y1="0" x2="188.5" y2="100" gradientUnits="userSpaceOnUse">\r
<stop stop-color="#F7F7F7"/>\r
<stop offset="1" stop-color="#F7F7F7" stop-opacity="0"/>\r
</linearGradient>\r
<linearGradient id="paint1_linear_115_10258" x1="230" y1="169" x2="230" y2="362" gradientUnits="userSpaceOnUse">\r
<stop stop-color="white" stop-opacity="0.9"/>\r
<stop offset="0.75" stop-color="white"/>\r
</linearGradient>\r
<linearGradient id="paint2_linear_115_10258" x1="223.75" y1="66.5" x2="223.75" y2="221" gradientUnits="userSpaceOnUse">\r
<stop stop-color="#F7F7F7"/>\r
<stop offset="1" stop-color="#F7F7F7" stop-opacity="0"/>\r
</linearGradient>\r
<linearGradient id="paint3_linear_115_10258" x1="252.75" y1="300.5" x2="252.75" y2="230" gradientUnits="userSpaceOnUse">\r
<stop stop-color="#F7F7F7" stop-opacity="0"/>\r
<stop offset="1" stop-color="#E8E8E8"/>\r
</linearGradient>\r
<linearGradient id="paint4_linear_115_10258" x1="229.5" y1="93" x2="229.5" y2="230" gradientUnits="userSpaceOnUse">\r
<stop stop-color="white"/>\r
<stop offset="1" stop-color="white" stop-opacity="0.4"/>\r
</linearGradient>\r
</defs>\r
</svg>\r
`,ta={class:"size"},sa={key:2},la={class:"calculate-result"},na={class:"text-h6"},oa={class:"no-data"},ia={class:"title",style:{width:"100%"}},ra=["innerHTML"],ua=["innerHTML"],ca={__name:"[id]",setup(k){const{locale:ee,setLocaleMessage:S}=ie({useScope:"global"}),E=Se(),{t:i}=ie(),Z=Ce(),F=c({}),H=E.params.id.split("-"),v=H[0],V=H[1],C=c({}),R=c({}),A=c("one"),B=c("0"),P=c(!0),b=c([]),$=c([]),D=c(""),ae=c(null),te=c(!1),de=[{title:"序号",key:"id"},{title:"分析类型",key:"extension"},{title:"分析结果",key:"originalName"}],pe=e=>{Re(`/nextStepAnalyse/${v}-${e}`)},q=c(""),O=c({}),se=c(null),M=c([]),le=re(()=>Z.getLanguage);be(le,(e,a)=>{P.value=!1,y(()=>{P.value=!0})});const ye=e=>{if(e.parameterRelationsVOS.length==0)return U=>({});let r=` (val) => {
${[...new Set(e.optionListZh.map(U=>U.value))].map(U=>{const he=e.parameterRelationsVOS.filter(x=>x.parameterValue==U).map(x=>x.nameSign),_e=e.parameterRelationsVOS.map(x=>{const G=he.includes(x.nameSign);return`${x.nameSign}: { display: ${x.operator==1?x.associatedParameterDisplay==2?!G:G:x.associatedParameterDisplay==2?G:!G} }`}).join(`,
    `);return`if (val == ${U}) {
  return {
    ${_e}
  };
}`}).join(`
 else `)}
}`;console.log(r,"functionStr");const t=r.trim(),z=t.indexOf("{"),g=t.lastIndexOf("}"),J=t.slice(z+1,g);return new Function("val",J)};(()=>{y(async()=>{const e=await Ie({toolId:v});O.value=e.data})})(),(()=>{y(async()=>{const e=await Ee({toolId:v});console.log(e,"res"),I(e.data,S),C.value=e.data})})(),(()=>{y(async()=>{const e=await He({toolId:v});I(e.data,S),F.value=e.data})})();const W=(e,a)=>{y(async()=>{$.value=[];const l=await Be({id:e});$.value=[l.data,...l.data.analysisResultVOList],$.value.forEach(r=>{r.executionTimeZh&&I(r,S),r.analyzeParameters=JSON.parse(r.analyzeParameters),r.analyzeParameters.forEach(t=>{I(t,S)})}),B.value=$.value.length-1,y(()=>{a&&(O.value.analysisWaitingType==1?ae.value[0].initSse():se.value[0].initSse())})})},me=e=>{y(async()=>{b.value.forEach(l=>{e[l.nameSign]!==void 0&&(l.inputType==3?l.value=e[`${l.nameSign}File`]:l.value=e[l.nameSign])});const a=await Ue({toolId:v,id:D.value,analyzeParameters:JSON.stringify(b.value)});q.value=a.data,W(D.value,!0)})};(()=>{y(async()=>{const e=await Pe({toolId:v});I(e.data,S),R.value=e.data,we({title:R.value.titleZh,meta:[{name:"description",content:R.value.descriptionZh},{name:"keywords",content:R.value.wordZh}]})})})();const fe=async()=>{y(async()=>{const e=await Oe({toolId:v,taskId:V});let a=["","VTextField","VTextField","VFileInput","VSelect","VRadioGroup","VCombobox","VSwitch"];console.log(e,"res"),b.value=e.data,M.value=[],e.data.forEach(l=>{I(l,S),l.defaultValue&&l.inputType==6&&(l.defaultValue=JSON.parse(l.defaultValue));let r=[];switch(l.inputType){case 1:r=[t=>!!t||i("allTools.InputPlaceholder"),t=>(t||"").length<=100||i("analysisTool.Cannot exceed one hundred characters")];break;case 4:r=[t=>t!=null||i("analysisRecord.SelectPlaceholder")];break;case 5:r=[t=>t!=null||i("analysisRecord.SelectPlaceholder")];break;case 6:r=[t=>t!=null||i("analysisRecord.SelectPlaceholder")];break;case 7:r=[t=>t!=null||i("analysisTool.Please set the switch state")];break;case 3:r=[t=>t&&t.length>0||i("analysisTool.Please upload a file")];break;default:r=[]}M.value.push({label:`name_${l.id}`,prop:l.nameSign,type:a[l.inputType],display:!l.associatedStatus,disabled:l.adjustable==0,cols:l.gridWidth==1?12:6,row:l.isFullRow==1,value:l.defaultValue,hint:l.helpInfoDisplay==1?`helpInfo_${l.id}`:"",dicDatazh:l.optionListZh,dicDataen:l.optionListEn,control:ye(l),rules:r,multiple:l.inputType==6,parameterFileRelationsVOS:l.parameterFileRelationsVOS}),console.log(M.value,"fields.value")}),P.value=!1,y(()=>{console.log(222),P.value=!0})})},ve=e=>typeof e!="string"||e.length===0?e:e.charAt(0).toUpperCase()+e.slice(1),ne=re(()=>ve(le.value));fe();const ge=e=>{console.log(e,"formData"),b.value.forEach(a=>{e[a.nameSign]!==void 0&&(a.inputType==3?a.value=e[`${a.nameSign}File`]:(a.value=e[a.nameSign],[4,5].includes(a.inputType)?(console.log(a,"field"),a[`optionList${ne.value}`].forEach(l=>{l.value==e[a.nameSign]&&(a.nameValue=l.label)})):a.inputType==6?e[a.nameSign].forEach(l=>{a[`optionList${ne.value}`].forEach(r=>{r.value==l.value&&(a.nameValue=a.nameValue?a.nameValue+","+r.label:r.label)})}):a.inputType==7?a.nameValue=e[a.nameSign]?"开":"关":a.nameValue=e[a.nameSign]))}),b.value=b.value.filter(a=>Array.isArray(a.value)?a.value.length>0:a.value!==null&&a.value!==void 0&&a.value!==""),console.log(b.value,"parameterData.value"),y(async()=>{const a=await Ze({toolId:v,analyzeParameters:JSON.stringify(b.value)});console.log(a,"res"),te.value=!0,D.value=a.data,W(a.data,!0)})},oe=()=>{console.log(123),W(D.value,!1)};return(e,a)=>{const l=Ve,r=ea;return p(),m(N,null,{default:n(()=>[o(d,{cols:"12",md:"6"},{default:n(()=>[s(P)?(p(),m(l,{key:0,analyseId:s(D),fields:s(M),isSubmit:s(te),onSubmit:ge,onFineTuningAnalysis:me},null,8,["analyseId","fields","isSubmit"])):_("",!0)]),_:1}),o(d,{cols:"12",md:"6"},{default:n(()=>[o(ze,{style:{height:"100%"}},{default:n(()=>[o(Ge,{modelValue:s(A),"onUpdate:modelValue":a[0]||(a[0]=t=>K(A)?A.value=t:null),class:"custom-underlined-tabs"},{default:n(()=>[o(Q,{value:"1"},{default:n(()=>[f(u(s(i)("analysisTool.Result display")),1)]),_:1}),w(o(Q,{value:"2"},{default:n(()=>[f(u(s(i)("analysisTool.Application Case")),1)]),_:1},512),[[L,s(C).status==1]]),w(o(Q,{value:"3"},{default:n(()=>[f(u(s(i)("analysisTool.Tool Description")),1)]),_:1},512),[[L,s(F).status==1]])]),_:1},8,["modelValue"]),o(je,null,{default:n(()=>[h("div",null,[o(Ne,{modelValue:s(A),"onUpdate:modelValue":a[2]||(a[2]=t=>K(A)?A.value=t:null)},{default:n(()=>[o(X,{value:"1"},{default:n(()=>[s($).length>0?(p(),m(qe,{key:0,modelValue:s(B),"onUpdate:modelValue":a[1]||(a[1]=t=>K(B)?B.value=t:null)},{default:n(()=>[(p(!0),j(Y,null,ue(s($),(t,z)=>(p(),m(We,null,{default:n(()=>[o(Je,null,{default:n(({expanded:g})=>[o(N,{"no-gutters":""},{default:n(()=>[o(d,{class:"d-flex justify-start",cols:"4"},{default:n(()=>[h("span",ta,u(z==0?s(i)("analysisTool.First run"):`第${z}次微调`),1)]),_:2},1024),o(d,{class:"text--secondary",cols:"8"},{default:n(()=>[o(Le,{"leave-absolute":""},{default:n(()=>[w(o(N,{style:{width:"100%"},"no-gutters":""},{default:n(()=>[o(d,{class:"d-flex justify-end task-time",cols:"12"},{default:n(()=>[f("任务完成！耗时： "+u(s(i)(`executionTime_${t.id}`))+" --[2025-02-16 18:03]",1)]),_:2},1024)]),_:2},1536),[[L,t.executionTimeZh]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),o(Ke,null,{default:n(()=>[o(N,null,{default:n(()=>[o(d,{cols:"12"},{default:n(()=>[f(u(s(i)("analysisTool.Task submission time"))+"："+u(t.submitTime),1)]),_:2},1024),t.executionTimeZh?(p(),m(d,{key:0,cols:"12"},{default:n(()=>[f(u(s(i)("analysisTool.Task start time"))+"："+u(t.executeTimeBegin),1)]),_:2},1024)):_("",!0),t.executionTimeZh?(p(),m(d,{key:1,cols:"12"},{default:n(()=>[f(u(s(i)("analysisTool.Task end time"))+"："+u(t.executeTimeEnd),1)]),_:2},1024)):_("",!0),o(d,{cols:"12",class:"operation-analyse"},{default:n(()=>[f(u(s(i)("analysisTool.Analysis values"))+"： ",1),(p(!0),j(Y,null,ue(t.analyzeParameters,g=>(p(),m(Qe,{class:"mt-3 chip-analyse",key:g.id,text:`${s(i)(`name_${g.id}`)}:${g.nameValue}`,value:`${s(i)(`name_${g.id}`)}:${g.nameValue}`},null,8,["text","value"]))),128))]),_:2},1024),t.executionTimeZh?(p(),j("div",sa,[w(o(d,{cols:"12"},{default:n(()=>[f(u(s(i)("analysisTool.Calculation results"))+"：",1)]),_:1},512),[[L,!e.$vuetify.display.lgAndUp]]),o(d,{cols:"12",class:"wrap"},{default:n(()=>[h("span",la,[w(h("span",null,u(s(i)("analysisTool.Calculation results"))+"：",513),[[L,e.$vuetify.display.lgAndUp]])]),o(Xe,{"hide-default-footer":"",headers:de,items:t.calculationResultFileList,class:"text-no-wrap"},{"item.id":n(({item:g,index:J})=>[h("span",na,u(J+1),1)]),_:2},1032,["items"])]),_:2},1024),w(o(d,{cols:"12"},{default:n(()=>[f(u(s(i)("analysisTool.Analyze volcano plot"))+"：",1)]),_:1},512),[[L,!e.$vuetify.display.lgAndUp]]),o(d,{cols:"12",class:"wrap"},{default:n(()=>[w(h("span",null,u(s(i)("analysisTool.Analyze volcano plot"))+"：",513),[[L,e.$vuetify.display.lgAndUp]]),o(ke,{width:300,height:"125","aspect-ratio":"16/9",cover:"",src:t.analysisResultFileList[0].link},null,8,["src"])]),_:2},1024),o(d,{cols:"12",innerHTML:s(i)(`analysisResult_${t.id}`)},null,8,["innerHTML"])])):_("",!0),s(O).analysisWaitingType==2?(p(),m(d,{key:3,cols:"12"},{default:n(()=>[o(r,{type:"subscribe",withCredentials:!0,executionTime:t.executionTimeZh,ref_for:!0,ref_key:"subscribeRef",ref:se,onMessage:oe,url:`/sciapi/sse/subscribe/${s(q)||s(D)}`},null,8,["executionTime","url"])]),_:2},1024)):_("",!0),s(O).analysisWaitingType==1?(p(),m(d,{key:4,cols:"12"},{default:n(()=>[o(r,{type:"subscribeResult",withCredentials:!0,onMessage:oe,time:s(O).analysisDuration,executionTime:t.executionTimeZh,ref_for:!0,ref_key:"subscribeResultRef",ref:ae,url:`/sciapi/sse/subscribe/${s(q)||s(D)}`},null,8,["time","executionTime","url"])]),_:2},1024)):_("",!0),t.executionTimeZh?(p(),m(d,{key:5,cols:"12",class:"operate"},{default:n(()=>[o(Fe,{class:"next-step-analyse",onClick:g=>pe(t.id)},{default:n(()=>[f(u(s(i)("analysisTool.Further analysis")),1)]),_:2},1032,["onClick"])]),_:2},1024)):_("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))]),_:1},8,["modelValue"])):_("",!0),w(h("div",oa,[o(s(Me),{nodes:("h"in e?e.h:s($e))("div",{innerHTML:("processSvgCopy"in e?e.processSvgCopy:s(De))(s(aa)),style:"line-height:0; color: rgb(var(--v-global-theme-primary));"})},null,8,["nodes"]),h("div",ia,u(s(i)("allTools.noDataText")),1)],512),[[L,s($).length==0]])]),_:1}),o(X,{value:"2"},{default:n(()=>[h("div",{innerHTML:s(i)(`
applicationCase_${s(C).id}`)},null,8,ra)]),_:1}),o(X,{value:"3"},{default:n(()=>[h("div",{innerHTML:s(i)(`
description_${s(F).id}`)},null,8,ua)]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1})]),_:1})]),_:1})}}},Ja=ce(ca,[["__scopeId","data-v-a06d4d58"]]);export{Ja as default};
