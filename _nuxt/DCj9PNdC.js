import{I as ve,r as m,h as he,e as Q,w as ge,c as W,l,j as a,F as X,n as Pe,a as v,b as h,u as e,q as f,t as u,G as N,d as z,z as V,s as q,x as Ve,L as be,aM as ye}from"./4Ktyr8G_.js";import{b as Y,v as Z,a as ee}from"./DKz0NZsm.js";import{s as ae}from"./BvwAGGOz.js";import{e as le,a as C,s as Ce,c as _e,b as xe}from"./C3lmZdGn.js";import{_ as Ee,g as ke}from"./iRvYXIdc.js";import{V as b,a as w}from"./DlxhMtx2.js";import{V as O,a as j,b as _}from"./BVo5q2wa.js";import{V as H}from"./M4sPlSOX.js";import{V as x}from"./U2mkAfXu.js";import{V as g}from"./B01AR6UH.js";import{V as Ne}from"./er4xnGW9.js";import{V as Se,a as Be,b as Ie}from"./Vc9XBB0d.js";import"./By1GlJfL.js";import"./-VStuZKb.js";import"./CryL740R.js";/* empty css        */import"./ZuLc9MOj.js";import"./DWGaNmQL.js";import"./BrBayNQn.js";import"./BxUkLsYu.js";import"./BJWT1Lrs.js";import"./D-5uWIj4.js";import"./BgxtWXOh.js";import"./B8vluWYP.js";const Fe={class:"d-flex flex-wrap gap-4"},Ue={class:"d-flex flex-wrap gap-4"},$e={class:"text-h6 text-medium-emphasis mt-1"},Re={class:"d-flex flex-wrap gap-4"},ta={__name:"changePassword",setup(Le){const{$phonePrefix:oe}=ve(),S=m(!1),B=m(!1),I=m(!1),ne=he(),{t:o}=Q(),{locale:se}=Q({useScope:"global"}),t=m({}),F=m(!1),U=m(!1),$=m(!1),i=m({phonePrefix:"+86",newPhone:"",code:""}),c=m({newEmail:"",code:""}),d=m({currentPassword:"",newPassword:"",confirmPassword:""}),n=m({newPhone:void 0,code:void 0,newEmail:void 0,emailCode:void 0,currentPassword:void 0,newPassword:void 0,confirmPassword:void 0}),R=m(!1),P=m(0),L=m(!1),y=m(0),re=["home.length","home.characterTypes","home.specialChars"],G=()=>{Pe(()=>{ke().then(p=>{t.value=p.data})})};G(),ge(se,()=>{n.value.newPhone&&E(),n.value.code&&T(),n.value.newEmail&&k(),n.value.emailCode&&A(),n.value.newPassword&&M(),n.value.confirmPassword&&D()});const E=()=>i.value.newPhone.length!=0?typeof Y(i.value.phonePrefix,i.value.newPhone)=="string"?(n.value.newPhone=o(Y(i.value.phonePrefix,i.value.newPhone)),!1):(n.value.newPhone=void 0,!0):(n.value.newPhone=o("login.Please enter your phone number"),!1),T=()=>i.value.code.length!=0?(n.value.code=void 0,!0):(n.value.code=o("login.Please enter your verification code"),!1),te=()=>{R.value=!0;let p=`${i.value.phonePrefix} ${i.value.newPhone}`;_e(p,"BIND_ACCOUNT").then(s=>{R.value=!1,P.value=60;const r=ae(()=>{P.value--,P.value<=0&&clearInterval(r)},1e3)}).catch(s=>{R.value=!1})},ie=()=>{if(E()){if(P.value>0)return;te()}},J=()=>{i.value.phonePrefix="+86",i.value.newPhone="",i.value.code="",n.value.newPhone=void 0,n.value.code=void 0},de=()=>{if(E(),T(),E()&&T()){F.value=!0;let p=`${i.value.phonePrefix} ${i.value.newPhone}`;le("",p,i.value.code).then(s=>{t.value.phoneNumber==null||t.value.phoneNumber==""?C("primary",o("home.Bind successfully")):C("primary",o("home.Change successfully")),G(),J(),F.value=!1}).catch(s=>{F.value=!1})}},k=()=>c.value.newEmail.length!=0?typeof Z(c.value.newEmail)=="string"?(n.value.newEmail=o(Z(c.value.newEmail)),!1):(n.value.newEmail=void 0,!0):(n.value.newEmail=o("login.Please enter your email address"),!1),A=()=>c.value.code.length!=0?(n.value.emailCode=void 0,!0):(n.value.emailCode=o("login.Please enter your verification code"),!1),ue=()=>{L.value=!0,xe(c.value.newEmail,"BIND_ACCOUNT").then(p=>{L.value=!1,y.value=60;const s=ae(()=>{y.value--,y.value<=0&&clearInterval(s)},1e3)}).catch(p=>{L.value=!1})},me=()=>{if(k()){if(y.value>0)return;ue()}},K=()=>{c.value.newEmail="",c.value.code="",n.value.newEmail=void 0,n.value.emailCode=void 0},fe=()=>{k(),A(),k()&&A()&&(U.value=!0,le(c.value.newEmail,"",c.value.code).then(p=>{t.value.email==null||t.value.email==""?C("primary",o("home.Bind successfully")):C("primary",o("home.Change successfully")),G(),K(),U.value=!1}).catch(p=>{U.value=!1}))},ce=()=>{d.value.currentPassword="",d.value.newPassword="",d.value.confirmPassword="",n.value.currentPassword=void 0,n.value.newPassword=void 0,n.value.confirmPassword=void 0},M=()=>d.value.newPassword.length!=0?typeof ee(d.value.newPassword)=="string"?(n.value.newPassword=o(ee(d.value.newPassword)),!1):(n.value.newPassword=void 0,!0):(n.value.newPassword=o("login.Please enter your password"),!1),D=()=>d.value.confirmPassword.length!=0?d.value.newPassword!==d.value.confirmPassword?(n.value.confirmPassword=o("login.PasswordsDoNotMatch"),!1):(n.value.confirmPassword=void 0,!0):(n.value.confirmPassword=o("login.Please enter your password again"),!1),pe=()=>{M(),D(),M()&&D()&&($.value=!0,Ce(ye(d.value.currentPassword),d.value.newPassword,d.value.confirmPassword).then(p=>{t.value.password==null||t.value.password==""?C("primary",o("home.Setting successful, now redirecting to login page")):C("primary",o("home.Change successful, now redirecting to login page")),$.value=!1,setTimeout(()=>{ne.logout()},2e3)}).catch(p=>{$.value=!1}))};return(p,s)=>(v(),W(X,null,[l(Ee,{ref:"headerRef",class:"mb-5"},null,512),l(b,null,{default:a(()=>[l(w,{cols:"12"},{default:a(()=>[l(O,null,{default:a(()=>[l(j,{class:"pb-6"},{default:a(()=>[e(t).phoneNumber?(v(),h(_,{key:0},{default:a(()=>[f(u(e(o)("home.Change Phone")),1)]),_:1})):(v(),h(_,{key:1},{default:a(()=>[f(u(e(o)("home.Setting Phone")),1)]),_:1}))]),_:1}),l(H,{onSubmit:N(de,["prevent"])},{default:a(()=>[l(x,{class:"pt-0"},{default:a(()=>[e(t).phoneNumber?(v(),h(b,{key:0},{default:a(()=>[l(w,{cols:"12",md:"6"},{default:a(()=>[l(g,{modelValue:e(t).phoneNumber,"onUpdate:modelValue":s[0]||(s[0]=r=>e(t).phoneNumber=r),autocomplete:"on",label:e(o)("login.phone"),disabled:!0,placeholder:""},null,8,["modelValue","label"])]),_:1})]),_:1})):z("",!0),l(b,null,{default:a(()=>[l(w,{cols:"12",md:"6"},{default:a(()=>[l(g,{modelValue:e(i).newPhone,"onUpdate:modelValue":s[2]||(s[2]=r=>e(i).newPhone=r),label:e(t).phoneNumber?e(o)("home.New Phone"):e(o)("login.phone"),autocomplete:"on",placeholder:"","error-messages":e(n).newPhone,onBlur:E},{prepend:a(()=>[l(Ne,{modelValue:e(i).phonePrefix,"onUpdate:modelValue":s[1]||(s[1]=r=>e(i).phonePrefix=r),items:e(oe)},null,8,["modelValue","items"])]),_:1},8,["modelValue","label","error-messages"])]),_:1}),l(w,{cols:"12",md:"6"},{default:a(()=>[l(g,{modelValue:e(i).code,"onUpdate:modelValue":s[3]||(s[3]=r=>e(i).code=r),label:e(o)("login.VerificationCode"),placeholder:"","error-messages":e(n).code,onBlur:T},{append:a(()=>[l(V,{block:"",loading:e(R),style:{height:"100%"},disabled:e(P)>0||e(i).newPhone.length==0,onClick:N(ie,["stop"])},{default:a(()=>[f(u(e(P)>0?`${e(P)}s ${e(o)("login.Retry")}`:e(o)("login.GetVerificationCode")),1)]),_:1},8,["loading","disabled"])]),_:1},8,["modelValue","label","error-messages"])]),_:1})]),_:1})]),_:1}),l(x,null,{default:a(()=>[q("div",Fe,[l(V,{type:"submit",loading:e(F)},{default:a(()=>[f(u(e(t).phoneNumber?e(o)("home.Save changes"):e(o)("home.Save")),1)]),_:1},8,["loading"]),l(V,{color:"secondary",variant:"outlined",onClick:J},{default:a(()=>[f(u(e(o)("home.Reset")),1)]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),l(w,{cols:"12"},{default:a(()=>[l(O,null,{default:a(()=>[l(j,{class:"pb-6"},{default:a(()=>[e(t).email?(v(),h(_,{key:0},{default:a(()=>[f(u(e(o)("home.Change Email")),1)]),_:1})):(v(),h(_,{key:1},{default:a(()=>[f(u(e(o)("home.Setting Email")),1)]),_:1}))]),_:1}),l(H,{onSubmit:N(fe,["prevent"])},{default:a(()=>[l(x,{class:"pt-0"},{default:a(()=>[e(t).email?(v(),h(b,{key:0},{default:a(()=>[l(w,{cols:"12",md:"6"},{default:a(()=>[l(g,{modelValue:e(t).email,"onUpdate:modelValue":s[4]||(s[4]=r=>e(t).email=r),autocomplete:"on",label:e(o)("login.Email"),disabled:!0,placeholder:""},null,8,["modelValue","label"])]),_:1})]),_:1})):z("",!0),l(b,null,{default:a(()=>[l(w,{cols:"12",md:"6"},{default:a(()=>[l(g,{modelValue:e(c).newEmail,"onUpdate:modelValue":s[5]||(s[5]=r=>e(c).newEmail=r),label:e(t).email?e(o)("home.New Email"):e(o)("login.Email"),autocomplete:"on",placeholder:"","error-messages":e(n).newEmail,onBlur:k},null,8,["modelValue","label","error-messages"])]),_:1}),l(w,{cols:"12",md:"6"},{default:a(()=>[l(g,{modelValue:e(c).code,"onUpdate:modelValue":s[6]||(s[6]=r=>e(c).code=r),label:e(o)("login.VerificationCode"),placeholder:"","error-messages":e(n).emailCode,onBlur:A},{append:a(()=>[l(V,{block:"",loading:e(L),style:{height:"100%"},disabled:e(P)>0||e(c).newEmail=="",onClick:N(me,["stop"])},{default:a(()=>[f(u(e(y)>0?`${e(y)}s ${e(o)("login.Retry")}`:e(o)("login.GetVerificationCode")),1)]),_:1},8,["loading","disabled"])]),_:1},8,["modelValue","label","error-messages"])]),_:1})]),_:1})]),_:1}),l(x,null,{default:a(()=>[q("div",Ue,[l(V,{type:"submit",loading:e(U)},{default:a(()=>[f(u(e(t).email?e(o)("home.Save changes"):e(o)("home.Save")),1)]),_:1},8,["loading"]),l(V,{color:"secondary",variant:"outlined",onClick:K},{default:a(()=>[f(u(e(o)("home.Reset")),1)]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),l(w,{cols:"12"},{default:a(()=>[l(O,null,{default:a(()=>[l(j,{class:"pb-6"},{default:a(()=>[e(t).password!=null?(v(),h(_,{key:0},{default:a(()=>[f(u(e(o)("home.Change Password")),1)]),_:1})):(v(),h(_,{key:1},{default:a(()=>[f(u(e(o)("home.Setting Password")),1)]),_:1}))]),_:1}),l(H,{onSubmit:N(pe,["prevent"])},{default:a(()=>[l(x,{class:"pt-0"},{default:a(()=>[e(t).password!=null?(v(),h(b,{key:0},{default:a(()=>[l(w,{cols:"12",md:"6"},{default:a(()=>[l(g,{modelValue:e(d).currentPassword,"onUpdate:modelValue":s[7]||(s[7]=r=>e(d).currentPassword=r),type:e(S)?"text":"password","append-inner-icon":e(S)?"ri-eye-off-line":"ri-eye-line",autocomplete:"on",label:e(o)("home.Current Password"),placeholder:"············","onClick:appendInner":s[8]||(s[8]=r=>S.value=!e(S))},null,8,["modelValue","type","append-inner-icon","label"])]),_:1})]),_:1})):z("",!0),l(b,null,{default:a(()=>[l(w,{cols:"12",md:"6"},{default:a(()=>[l(g,{modelValue:e(d).newPassword,"onUpdate:modelValue":s[9]||(s[9]=r=>e(d).newPassword=r),type:e(B)?"text":"password","append-inner-icon":e(B)?"ri-eye-off-line":"ri-eye-line",label:e(t).password?e(o)("home.New Password"):e(o)("login.Password"),autocomplete:"on",placeholder:"············","onClick:appendInner":s[10]||(s[10]=r=>B.value=!e(B)),"error-messages":e(n).newPassword,onBlur:M},null,8,["modelValue","type","append-inner-icon","label","error-messages"])]),_:1}),l(w,{cols:"12",md:"6"},{default:a(()=>[l(g,{modelValue:e(d).confirmPassword,"onUpdate:modelValue":s[11]||(s[11]=r=>e(d).confirmPassword=r),type:e(I)?"text":"password","append-inner-icon":e(I)?"ri-eye-off-line":"ri-eye-line",autocomplete:"on",label:e(o)("home.Confirm Password"),placeholder:"············","onClick:appendInner":s[12]||(s[12]=r=>I.value=!e(I)),onBlur:D,"error-messages":e(n).confirmPassword},null,8,["modelValue","type","append-inner-icon","label","error-messages"])]),_:1})]),_:1})]),_:1}),l(x,null,{default:a(()=>[q("h6",$e,u(e(o)("home.Password Requirements"))+":",1),l(Se,null,{default:a(()=>[(v(),W(X,null,Ve(re,(r,we)=>l(Be,{key:we,class:"px-0"},{prepend:a(()=>[l(be,{size:"8",icon:"ri-circle-fill",color:"rgba(var(--v-theme-on-surface), var(--v-medium-emphasis-opacity))"})]),default:a(()=>[l(Ie,{class:"text-medium-emphasis text-wrap"},{default:a(()=>[f(u(e(o)(r)),1)]),_:2},1024)]),_:2},1024)),64))]),_:1}),q("div",Re,[l(V,{type:"submit",loading:e($)},{default:a(()=>[f(u(e(t).password?e(o)("home.Save changes"):e(o)("home.Save")),1)]),_:1},8,["loading"]),l(V,{color:"secondary",variant:"outlined",onClick:ce},{default:a(()=>[f(u(e(o)("home.Reset")),1)]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})],64))}};export{ta as default};
