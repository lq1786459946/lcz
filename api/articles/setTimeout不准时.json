{"title":"setTimeout不准时?","uid":"29983d06ba41eaf724125282c4708e00","slug":"setTimeout不准时","date":"2025-01-03T05:52:50.000Z","updated":"2025-01-03T06:11:55.237Z","comments":true,"path":"api/articles/setTimeout不准时.json","keywords":null,"cover":null,"content":"<h2 id=\"演示\"><a href=\"#演示\" class=\"headerlink\" title=\"演示\"></a>演示</h2><p>使用一个计数器来记录每次 <code>setTimeout</code> 的调用。设定的间隔时间乘以计数次数，理想情况下应等于预期的延迟。通过以下示例，可以检查我们计时器的准确性。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">time</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> speed = <span class=\"number\">50</span>, <span class=\"comment\">// 间隔</span></span><br><span class=\"line\">    count = <span class=\"number\">1</span>; <span class=\"comment\">// 计数</span></span><br><span class=\"line\">  start = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">getTime</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">instance</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ideal = count * speed,</span><br><span class=\"line\">      real = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">getTime</span>() - start;</span><br><span class=\"line\"></span><br><span class=\"line\">    count++;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(count + <span class=\"string\">&quot;理想值------------------------：&quot;</span>, ideal); <span class=\"comment\">// 记录理想值</span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(count + <span class=\"string\">&quot;真实值------------------------：&quot;</span>, real); <span class=\"comment\">// 记录理想值</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> diff = real - ideal;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(count + <span class=\"string\">&quot;差值------------------------：&quot;</span>, diff); <span class=\"comment\">// 差值</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 小于5执行</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (count &lt; <span class=\"number\">5</span>) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">window</span>.<span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">instance</span>();</span><br><span class=\"line\">      &#125;, speed);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">window</span>.<span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">instance</span>();</span><br><span class=\"line\">  &#125;, speed);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"打印-1\"><a href=\"#打印-1\" class=\"headerlink\" title=\"打印 1\"></a>打印 1</h4><p>2 理想值————————： 50<br>2 真实值————————： 59<br>2 差值————————： 9<br>3 理想值————————： 100<br>3 真实值————————： 126<br>3 差值————————： 26<br>4 理想值————————： 150<br>4 真实值————————： 180<br>4 差值————————： 30<br>5 理想值————————： 200<br>5 真实值————————： 232<br>5 差值————————： 32</p>\n<p>我们可以在 <code>setTimeout</code> 执行之前加入额外的代码逻辑，然后再观察这个差值。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"><span class=\"variable language_\">window</span>.<span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    <span class=\"title function_\">instance</span>();</span><br><span class=\"line\">&#125;, speed);</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> a = <span class=\"number\">1</span>, i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10000000</span>; i++) &#123;</span><br><span class=\"line\">    a *= (i + <span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>2 理想值————————： 50<br>2 真实值————————： 62<br>2 差值————————： 12<br>3 理想值————————： 100<br>3 真实值————————： 122<br>3 差值————————： 22<br>4 理想值————————： 150<br>4 真实值————————： 174<br>4 差值————————： 24<br>5 理想值————————： 200<br>5 真实值————————： 228<br>5 差值————————： 28</p>\n<h2 id=\"setTimeout-系统时间补偿\"><a href=\"#setTimeout-系统时间补偿\" class=\"headerlink\" title=\"setTimeout 系统时间补偿\"></a>setTimeout 系统时间补偿</h2><p>当每一次定时器执行时后，都去获取系统的时间来进行修正，虽然每次运行可能会有误差，但是通过系统时间对每次运行的修复，能够让后面每一次时间都得到一个补偿。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">time</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> speed = <span class=\"number\">50</span>, <span class=\"comment\">// 间隔</span></span><br><span class=\"line\">    count = <span class=\"number\">1</span>; <span class=\"comment\">// 计数</span></span><br><span class=\"line\">  start = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">getTime</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">function</span> <span class=\"title function_\">instance</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ideal = count * speed,</span><br><span class=\"line\">      real = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">getTime</span>() - start;</span><br><span class=\"line\"></span><br><span class=\"line\">    count++;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(count + <span class=\"string\">&quot;理想值------------------------：&quot;</span>, ideal); <span class=\"comment\">// 记录理想值</span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(count + <span class=\"string\">&quot;真实值------------------------：&quot;</span>, real); <span class=\"comment\">// 记录理想值</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> diff = real - ideal;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(count + <span class=\"string\">&quot;差值------------------------：&quot;</span>, diff); <span class=\"comment\">// 差值</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 5次后不再执行</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (count &lt; <span class=\"number\">5</span>) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">window</span>.<span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">instance</span>();</span><br><span class=\"line\">      &#125;, speed - diff);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable language_\">window</span>.<span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">instance</span>();</span><br><span class=\"line\">  &#125;, speed);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","feature":true,"text":"演示使用一个计数器来记录每次 setTimeout 的调用。设定的间隔时间乘以计数次数，理想情况下应等于预期的延迟。通过以下示例，可以检查我们计时器的准确性。 ...","permalink":"/post/setTimeout不准时","photos":[],"count_time":{"symbolsCount":"2.3k","symbolsTime":"2 mins."},"categories":[{"name":"JS","slug":"JS","count":4,"path":"api/categories/JS.json"}],"tags":[{"name":"JS","slug":"JS","count":4,"path":"api/tags/JS.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%BC%94%E7%A4%BA\"><span class=\"toc-text\">演示</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%89%93%E5%8D%B0-1\"><span class=\"toc-text\">打印 1</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#setTimeout-%E7%B3%BB%E7%BB%9F%E6%97%B6%E9%97%B4%E8%A1%A5%E5%81%BF\"><span class=\"toc-text\">setTimeout 系统时间补偿</span></a></li></ol>","author":{"name":"权栈","slug":"blog-author","avatar":"https://p6-passport.byteacctimg.com/img/user-avatar/40c734cabc45915e93f17b88134aa761~140x140.awebp","link":"/","description":"成就伟大的唯一途径就是热爱你所做的事情","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{},"next_post":{"title":"Vue3的provide和inject源码","uid":"6bbd855e83e27561534b81f565184962","slug":"Vue3的provide和inject源码","date":"2024-12-27T04:32:10.000Z","updated":"2024-12-27T06:37:20.925Z","comments":true,"path":"api/articles/Vue3的provide和inject源码.json","keywords":null,"cover":null,"text":"provide和inject函数是如何实现数据多级传递的。 看个demo代码如下： 123456789101112<template> <ChildDemo /...","permalink":"/post/Vue3的provide和inject源码","photos":[],"count_time":{"symbolsCount":"4.5k","symbolsTime":"4 mins."},"categories":[{"name":"Vue3","slug":"Vue3","count":7,"path":"api/categories/Vue3.json"}],"tags":[{"name":"Vue3","slug":"Vue3","count":7,"path":"api/tags/Vue3.json"}],"author":{"name":"权栈","slug":"blog-author","avatar":"https://p6-passport.byteacctimg.com/img/user-avatar/40c734cabc45915e93f17b88134aa761~140x140.awebp","link":"/","description":"成就伟大的唯一途径就是热爱你所做的事情","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}