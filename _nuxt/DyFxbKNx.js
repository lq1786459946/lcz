import{_ as he}from"./CDo1OVWQ.js";import{_ as Te,h as _e,e as ae,r as m,i as G,w as Ie,n as D,c as F,l as s,j as r,q as k,t as c,u as t,m as J,s as v,G as z,p as S,v as L,a2 as $,z as j,L as R,F as V,x,a as p,b as C,y as we}from"./4Ktyr8G_.js";import{a as U}from"./-VStuZKb.js";import{u as le}from"./CAblgYOR.js";import{a as xe,b as Ce}from"./9bGsdqAp.js";import{g as B}from"./C3lmZdGn.js";import{V as Ue}from"./D2UNG8S4.js";import{V as te,a as De,b as ze}from"./BVo5q2wa.js";import{V as oe}from"./U2mkAfXu.js";import{V as Se}from"./M4sPlSOX.js";import{V as Le,a as g}from"./DlxhMtx2.js";import{V as Q}from"./er4xnGW9.js";import{a as A,V as W,b as X}from"./Vc9XBB0d.js";import{V as Ae}from"./C01xEgWl.js";import{V as Be}from"./BNhRW4Wg.js";import{V as Y}from"./BrBayNQn.js";import{V as Me}from"./B01AR6UH.js";import{V as re}from"./CdJNxXyl.js";import{V as Ne}from"./BhH3YVHS.js";import{V as se}from"./BgxtWXOh.js";const fa=(y,E,P)=>B("/sciapi/api/feedback/page",{method:"post",params:{...P,current:y,size:E}}),$e=y=>B("/sciapi/api/feedback/save",{method:"post",body:y}),ba=y=>B("/sciapi/api/feedback/detail",{method:"post",params:{id:y}}),je=y=>B("/sciapi/api/dict-biz/dictionary-tree",{method:"get",params:y}),ka=y=>B("/sciapi/api/dict-biz/dictionary",{method:"get",params:y}),Re={class:"text-center mb-6"},Ee={class:"text-h4 mb-2"},Pe=["innerHTML"],qe={class:"d-flex flex-wrap mt-2"},Ke={class:"text"},Oe={__name:"feedback-add",emits:["refreshChange"],setup(y,{expose:E,emit:P}){const M=_e(),{setLocaleMessage:h}=ae({useScope:"global"}),{t:o,locale:ie}=ae(),T=m(!1);let f=m(!1),_=m("");const q=m(null);let n=m({otherFile:null}),N=m(null),b=m([]),I=m(null);const ne=P,i=m({snackbar:!1,color:"success",location:"top",timeout:1500,text:"成功"}),ue=G(()=>[a=>!!a||o("myFeedback.FeedbackTypeIsNull")]),de=G(()=>[a=>!!a||o("myFeedback.IssueTypeIsNull")]),ce=G(()=>[a=>!!a||o("myFeedback.IssueContentIsNull"),a=>a.length<=500||o("myFeedback.IssueContentIsCount")]),me=[a=>!a||(a==null?void 0:a.length)<=4||o("myFeedback.UploadFileSize"),a=>{if(!a)return!0;const e=["image/jpg","image/png","image/jpeg"];return Array.from(a).every(u=>e.includes(u.type)||o("myFeedback.UploadImageType"))},a=>{if(!a)return!0;const e=2*1024*1024;return Array.from(a).every(u=>u.size<=e||o("myFeedback.UploadFileNum")+"2MB")}],pe=[a=>(a==null?void 0:a.length)<=1||o("myFeedback.UploadVideoSize"),a=>!a||!(a!=null&&a.length)?!0:["video/mp4"].includes(a[0].type)||o("myFeedback.UploadVideoType"),a=>{var e;return(((e=a[0])==null?void 0:e.size)||0)<=50*1024*1024||o("myFeedback.UploadFileNum")+"50MB"}];let K=m([]),O=m([]),ee=m([]),H=m([]);Ie(ie,()=>{D(()=>{var a;(a=N.value)==null||a.resetValidation()})}),(()=>{D(()=>{je({code:"feedback_type"}).then(a=>{let e=a.data||[];for(let u of e){u.titleZh=u.dictValue,u.titleEn=u.remark,U(u,h);for(let l of u.children)l.titleZh=l.dictValue,l.titleEn=l.remark,U(l,h)}K.value=e})})})();const ye=a=>{if(a){n.value.issueType&&(n.value.issueType="");let e=K.value.find(u=>u.dictKey==a);O.value=(e==null?void 0:e.children)||[]}else O.value=[]};(()=>{D(()=>{xe().then(a=>{let e=a.data||[];for(let u of e){U(u,h);for(let l of u.children){U(l,h);for(let d of l.children)U(d,h)}}ee.value=e})})})();const ve=a=>{if(a){n.value.analysisTypeId=a,_.value=o(`title_${a}`);let e=M.getUserData.user_id;Ce({toolId:a,presenterId:e}).then(u=>{let l=u.data||[];for(let d of l)U(d,h);H.value=l})}else n.value.analysisTaskId&&(n.value.analysisTaskId=""),H=[]},fe=a=>{if(b.value=[],!!a)try{Array.from(a).forEach(e=>{if(!["image/jpg","image/png","image/jpeg"].includes(e.type))throw i.value.snackbar=!0,i.value.text=o("myFeedback.UploadImageType"),i.value.color="error",new Error(o("myFeedback.UploadImageType"));if(e.size>2*1024*1024)throw i.value.snackbar=!0,i.value.text=o("myFeedback.UploadFileNum")+"2MB",i.value.color="error",new Error(o("myFeedback.UploadFileNum")+"2MB")}),Array.from(a).forEach(e=>{le(e).then(u=>{u.code==200?b.value.push(u.data):(i.value.snackbar=!0,i.value.text=u.msg,i.value.color="error")})})}catch(e){n.value.imageFile=null,i.value.snackbar=!0,i.value.text=e.message,i.value.color="error"}},be=async a=>{if(I.value=null,!!a)try{if(!["video/mp4"].includes(a.type))throw i.value.snackbar=!0,i.value.text=o("myFeedback.UploadVideoType")+"50MB",i.value.color="error",new Error(o("myFeedback.UploadVideoType"));if(a.size>50*1024*1024)throw i.value.snackbar=!0,i.value.text=o("myFeedback.UploadVideoType")+"50MB",i.value.color="error",new Error(o("myFeedback.UploadVideoType")+"50MB");le(a).then(e=>{e.code==200?I.value=e.data:(i.value.snackbar=!0,i.value.text=e.msg,i.value.color="error")}),await D(),q.value&&q.value.load()}catch(e){n.value.otherFile=null,i.value.snackbar=!0,i.value.text=e.message,i.value.color="error"}},ke=a=>{const e=[...n.value.imageFile];e.splice(a,1),n.value.imageFile=e,b.value.splice(a,1)},ge=async()=>{var a;await D(),(a=N.value)==null||a.reset(),Z()},Fe=async()=>{if(T.value)return;T.value=!0;const{valid:a}=await N.value.validate();if(a==!0){if(b.value.length){let e=b.value.map(u=>u.attachId||u.id);n.value.imageFileId=e.join(",")}else n.value.imageFileId="";I.value?n.value.otherFileId=I.value.attachId||I.value.id:n.value.otherFileId="",n.value.memberId=M.getUserData.user_id,$e(n.value).then(e=>{if(e.code==200)Z(),f.value=!1,i.value.snackbar=!0,i.value.text=o("myFeedback.Success"),i.value.color="success",ne("refreshChange",!0);else{let u=JSON.parse(e.msg);i.value.snackbar=!0,i.value.text=u[M.getLanguage],i.value.color="error",T.value=!1}})}else T.value=!1},Ve=()=>{Z()},Z=()=>{n.value={otherFile:null},b.value=[],I.value=null,q.value=null,_.value=""};return E({InitForm:()=>{M.getUserData.user_id?(T.value=!1,f.value=!0):(i.value.snackbar=!0,i.value.text=o("myFeedback.Login"),i.value.color="warning")}}),(a,e)=>{const u=he;return p(),F(V,null,[s(Ue,{modelValue:t(i).snackbar,"onUpdate:modelValue":e[0]||(e[0]=l=>t(i).snackbar=l),color:t(i).color,location:t(i).location,timeout:t(i).timeout},{default:r(()=>[k(c(t(i).text),1)]),_:1},8,["modelValue","color","location","timeout"]),s(Ne,{modelValue:t(f),"onUpdate:modelValue":[e[12]||(e[12]=l=>J(f)?f.value=l:f=l),Ve],width:a.$vuetify.display.smAndDown?"auto":"50%"},{default:r(()=>[s(u,{variant:"text",size:"default",onClick:e[1]||(e[1]=l=>J(f)?f.value=!1:f=!1)}),s(te,null,{default:r(()=>[s(De,null,{default:r(()=>[s(ze)]),_:1}),v("div",Re,[v("h4",Ee,c(t(o)("myFeedback.ProblemFeedback")),1)]),s(oe,null,{default:r(()=>[s(Se,{ref_key:"formRef",ref:N,onSubmit:z(Fe,["prevent"])},{default:r(()=>[s(Le,null,{default:r(()=>[s(g,{cols:"12",md:"6"},{default:r(()=>[s(Q,{rules:t(ue),modelValue:t(n).feedbackType,"onUpdate:modelValue":[e[2]||(e[2]=l=>t(n).feedbackType=l),ye],placeholder:t(o)("myFeedback.FeedbackType"),items:t(K),"item-value":"dictKey",label:t(o)("myFeedback.FeedbackType"),"persistent-hint":"",required:""},{item:r(({props:l,item:d})=>[s(A,$(l,{title:t(o)(`title_${d.raw.id}`)}),null,16,["title"])]),selection:r(({item:l})=>[S(v("span",null,c(t(o)(`title_${l.raw.id}`)),513),[[L,l&&l.raw]]),S(v("span",{class:"text-disabled"},c(t(o)("myCollection.SelectPlaceholder")),513),[[L,!l]])]),_:1},8,["rules","modelValue","placeholder","items","label"])]),_:1}),s(g,{cols:"12",md:"6"},{default:r(()=>[s(Q,{rules:t(de),modelValue:t(n).issueType,"onUpdate:modelValue":e[3]||(e[3]=l=>t(n).issueType=l),placeholder:t(o)("myFeedback.IssueType"),items:t(O),"item-value":"dictKey",label:t(o)("myFeedback.IssueType"),"persistent-hint":"",required:""},{item:r(({props:l,item:d})=>[s(A,$(l,{title:t(o)(`title_${d.raw.id}`)}),null,16,["title"])]),selection:r(({item:l})=>[S(v("span",null,c(t(o)(`title_${l.raw.id}`)),513),[[L,l&&l.raw]]),S(v("span",{class:"text-disabled"},c(t(o)("myCollection.SelectPlaceholder")),513),[[L,!l]])]),_:1},8,["rules","modelValue","placeholder","items","label"])]),_:1}),s(g,{cols:"12",md:"12"},{default:r(()=>[s(Ae,{rules:t(ce),modelValue:t(n).issueContent,"onUpdate:modelValue":e[4]||(e[4]=l=>t(n).issueContent=l),label:t(o)("myFeedback.IssueContent"),placeholder:t(o)("myFeedback.IssueContent"),clearable:"",maxlength:"500",counter:"","clear-icon":"ri-close-line",rows:"3",required:""},{prepend:r(()=>[s(Be,{location:"end"},{activator:r(({props:l})=>[s(j,$({icon:""},l,{color:"info",variant:"text",width:"25"}),{default:r(()=>[s(R,{color:"info",icon:"ri-question-fill",size:"20"})]),_:2},1040)]),default:r(()=>[v("span",{innerHTML:t(o)("myFeedback.Tip")},null,8,Pe)]),_:1})]),_:1},8,["rules","modelValue","label","placeholder"])]),_:1}),s(g,{cols:"12",md:"6"},{default:r(()=>[s(Y,{location:"bottom start"},{activator:r(({props:l})=>[s(Me,$({placeholder:t(o)("myFeedback.AnalysisType"),modelValue:t(_),"onUpdate:modelValue":e[5]||(e[5]=d=>J(_)?_.value=d:_=d),label:t(o)("myFeedback.AnalysisType")},l,{"append-inner-icon":"ri-arrow-down-s-line"}),null,16,["placeholder","modelValue","label"])]),default:r(()=>[s(W,null,{default:r(()=>[(p(!0),F(V,null,x(t(ee),l=>(p(),C(A,{key:l.id,onClick:e[7]||(e[7]=z(()=>{},["stop"]))},{append:r(()=>[s(R,{icon:"ri-arrow-right-s-line",size:"x-small"})]),default:r(()=>[s(X,null,{default:r(()=>[k(c(t(o)(`title_${l.id}`)),1)]),_:2},1024),s(Y,{activator:"parent",location:"end top","close-on-content-click":!1},{default:r(()=>[s(W,null,{default:r(()=>[(p(!0),F(V,null,x(l.children,d=>(p(),C(A,{key:d.id,onClick:e[6]||(e[6]=z(()=>{},["stop"]))},{append:r(()=>[s(R,{icon:"ri-arrow-right-s-line",size:"x-small"})]),default:r(()=>[s(X,null,{default:r(()=>[k(c(t(o)(`title_${d.id}`)),1)]),_:2},1024),s(Y,{activator:"parent",location:"end top"},{default:r(()=>[s(W,null,{default:r(()=>[(p(!0),F(V,null,x(d.children,w=>(p(),C(A,{key:w.id,link:""},{default:r(()=>[s(X,{onClick:Je=>ve(w.id)},{default:r(()=>[k(c(t(o)(`title_${w.id}`)),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),s(g,{cols:"12",md:"6"},{default:r(()=>[s(Q,{modelValue:t(n).analysisTaskId,"onUpdate:modelValue":e[8]||(e[8]=l=>t(n).analysisTaskId=l),placeholder:t(o)("myFeedback.AnalysisTask"),items:t(H),"item-value":"id","item-title":"taskName",label:t(o)("myFeedback.AnalysisTask"),"persistent-hint":""},null,8,["modelValue","placeholder","items","label"])]),_:1}),s(g,{cols:"12",md:"12"},{default:r(()=>[s(re,{placeholder:t(o)("myFeedback.ImageFileId"),modelValue:t(n).imageFile,"onUpdate:modelValue":[e[10]||(e[10]=l=>t(n).imageFile=l),fe],label:t(o)("myFeedback.ImageFileId"),accept:".png,.jpg,.jpeg","prepend-icon":"ri-camera-line",multiple:"",rules:me,"show-size":"",counter:"",clearable:"","hide-selected":"","max-files":4},{selection:r(({fileNames:l})=>[v("div",{onClick:e[9]||(e[9]=z(()=>{},["stop"]))},[(p(!0),F(V,null,x(l,(d,w)=>(p(),C(se,{key:w,class:"ma-1",color:"primary"},{default:r(()=>[k(c(d),1)]),_:2},1024))),128))])]),_:1},8,["placeholder","modelValue","label"]),S(v("div",qe,[(p(!0),F(V,null,x(t(b),(l,d)=>(p(),C(te,{key:l.id,class:"ma-1",width:"120"},{default:r(()=>[s(we,{src:l.link,height:"80",width:"120","scale-down":""},null,8,["src"]),s(oe,{class:"d-flex text-caption text-truncate pa-1 justify-space-between",width:"120"},{default:r(()=>[v("div",Ke,c(l.originalName),1),s(j,{icon:"",size:"x-small",variant:"text",onClick:w=>ke(d)},{default:r(()=>[s(R,{icon:"ri-close-line"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))],512),[[L,t(b).length]])]),_:1}),s(g,{cols:"12",md:"12"},{default:r(()=>[s(re,{modelValue:t(n).otherFile,"onUpdate:modelValue":[e[11]||(e[11]=l=>t(n).otherFile=l),be],label:t(o)("myFeedback.OtherFileId"),accept:"video/mp4",rules:pe,multiple:!1,"show-size":"","max-files":1,"prepend-icon":"ri-video-line"},{selection:r(({fileNames:l})=>[(p(!0),F(V,null,x(l,d=>(p(),C(se,{key:d,class:"me-2",color:"primary",size:"small",label:""},{default:r(()=>[k(c(d),1)]),_:2},1024))),128))]),_:1},8,["modelValue","label"])]),_:1}),s(g,{cols:"12",class:"text-center mt-5"},{default:r(()=>[s(j,{type:"submit",class:"me-3",loading:t(T)},{default:r(()=>[k(c(t(o)("myFeedback.Submit")),1)]),_:1},8,["loading"]),s(j,{variant:"outlined",color:"secondary",onClick:z(ge,["stop"])},{default:r(()=>[k(c(t(o)("myFeedback.Reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue","width"])],64)}}},ga=Te(Oe,[["__scopeId","data-v-245eb7e5"]]);export{ga as F,ka as a,ba as b,fa as g};
